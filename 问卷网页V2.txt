

**ğŸ“˜ äº§å“éœ€æ±‚æ–‡æ¡£ï¼ˆPRDï¼‰

ã€ŠæŠ•èµ„è§‰å¯Ÿ Â· ç”¨æˆ·ç”»åƒä¸ç›²ç‚¹è¯Šæ–­ V2ã€‹**

1. äº§å“èƒŒæ™¯ä¸ç›®æ ‡

1.1 èƒŒæ™¯

å½“ä¸‹æŠ•èµ„ç”¨æˆ·æ™®éé¢ä¸´ä¸‰ç±»â€œçœŸéœ€æ±‚â€ï¼š
ä¿¡æ¯å™ªå£°è¿‡è½½ â†’ éš¾ä»¥åˆ¤æ–­ä»€ä¹ˆå¯¹è‡ªå·±çœŸæ­£æœ‰ç”¨
æŠ•èµ„è¡Œä¸ºå—æƒ…ç»ªé©±åŠ¨ â†’ éš¾ä»¥å½¢æˆç¨³å®šçš„å†³ç­–æ¡†æ¶
ä¸äº†è§£è‡ªå·±çš„æŠ•èµ„è€…ç±»å‹ â†’ æ— æ³•æ‰¾åˆ°æœ€é€‚åˆçš„å­¦ä¹ /ç­–ç•¥è·¯å¾„

è¿™äº›éœ€æ±‚é•¿æœŸè¢«â€œäººæ ¼æµ‹è¯•â€â€œæ³›å¿ƒç†æµ‹è¯„â€ä½æ•ˆæ»¡è¶³ï¼Œè¯´æ˜å­˜åœ¨å·¨å¤§çš„æå‡ç©ºé—´ã€‚

æœ¬äº§å“ç›®æ ‡æ˜¯ä¸ºç”¨æˆ·å»ºç«‹ï¼š
å¯é‡åŒ–çš„æŠ•èµ„ç”»åƒ
å¯¹æŠ•èµ„ç›²ç‚¹çš„è§‰å¯Ÿ
èƒ½è¢«æŒç»­å¤ç”¨çš„æ•°æ®æ¨¡å‹ï¼Œç”¨äºåç»­åˆ†æä¸å­¦ä¹ æ¨è

åŒæ—¶æ„å»ºå¢é•¿é—­ç¯ï¼šå…¥å£ â†’ é‚®ç®± â†’ é—®å· â†’ åˆ†æ â†’ å›æµå­¦ä¹ è·¯å¾„ã€‚

1.2 äº§å“ç›®æ ‡ï¼ˆOutcomeï¼‰
è®©ç”¨æˆ·åœ¨ 5 åˆ†é’Ÿå†…å®Œæˆä¸€å¥—ç³»ç»Ÿçš„æŠ•èµ„è‡ªæˆ‘è¯„ä¼°
æ„å»ºé«˜è´¨é‡ç”¨æˆ·ç”»åƒï¼ˆå¿ƒæ™º + è¡Œä¸º + é£é™©åå¥½ + ä¿¡æ¯æ¥æºï¼‰
é‚®ç®±å¢é•¿ä¸ºæ ¸å¿ƒ KPIï¼ˆä¸åç»­å­¦ä¹ äº§å“è¿æ¥ï¼‰
è¾“å‡ºå¯ç”¨äºä¸‹ä¸€é˜¶æ®µä¸ªæ€§åŒ–å¼•æ“çš„ç»“æ„åŒ–æ•°æ®

2. ç”¨æˆ·ç”»åƒä¸éœ€æ±‚åˆ†æ

åŸºäºã€ŠçœŸéœ€æ±‚ã€‹çš„â€œéœ€æ±‚åœ°å›¾â€ä¸æ¢å®çš„â€œå®¢è§‚æ ¡éªŒâ€æ–¹æ³•ï¼Œä»¥ä¸‹æ˜¯å…¸å‹ç”¨æˆ·åŠå…¶çœŸéœ€æ±‚ï¼š

ç”¨æˆ·ç±»å‹ & çœŸéœ€æ±‚
ç”¨æˆ·ç±»å‹
çœŸéœ€æ±‚ï¼ˆçœŸå®ç—›ç‚¹ï¼‰
è¡Œä¸ºè¡¨ç°
æ–°æ‰‹æŠ•èµ„è€…
æƒ³çŸ¥é“â€œæˆ‘é€‚åˆæ€æ ·æŠ•èµ„â€
è·Ÿé£ã€çœ‹KOLã€é¢‘ç¹å˜æ¢ç­–ç•¥
æƒ…ç»ªå‹æŠ•èµ„è€…
ç®¡ä½å†²åŠ¨ã€é¿å…å¤§äº
é•¿æ—¶é—´ç›¯ç›˜ã€å®¹æ˜“ FOMO/FUD
ä½“ç³»å‹å­¦ä¹ è€…
å»ºç«‹æ˜ç¡®æ¡†æ¶ã€çŸ¥é“è‡ªå·±åœ¨å“ªä¸ªé˜¶æ®µ
å–œæ¬¢åšæµ‹è¯„ã€çŸ¥è¯†ç±»å·¥å…·
æœ‰ç»éªŒæŠ•èµ„è€…
æ‰¾åˆ°è‡ªå·±çš„ç›²ç‚¹ã€ç¡®è®¤é£é™©è¾¹ç•Œ
å·²æœ‰æŠ•èµ„ä½“ç³»ä½†æœ‰çŠ¹è±«ç‚¹
é«˜å‡€å€¼ç”¨æˆ·
è¦é«˜æ•ˆã€å¯ä¿¡çš„è‡ªæˆ‘å®¡è§†å·¥å…·
æ˜ç¡®ç›®æ ‡ä½†ç¼ºåé¦ˆæœºåˆ¶
å…±æ€§çœŸéœ€æ±‚ï¼šæƒ³â€œç†è§£è‡ªå·±â€è€Œä¸æ˜¯â€œå¾—åˆ°å»ºè®®â€ã€‚
â†’ æ‰€ä»¥äº§å“å®šä½å¿…é¡»æ˜¯â€œè‡ªæˆ‘è§‰å¯Ÿå·¥å…·â€ï¼Œè€Œä¸æ˜¯æŠ•èµ„å»ºè®®å·¥å…·ã€‚

3. æœºä¼šåˆ†æï¼ˆå‘æ•£ â†’ æ”¶æ•›ï¼‰

3.1 å‘æ•£ï¼ˆæ½œåœ¨æ–¹å‘ï¼‰
æŠ•èµ„äººæ ¼æ¨¡å‹ï¼ˆMBTI-likeï¼‰
æ˜Ÿåº§å¼è½»å…¥å£
æŠ•èµ„è¡Œä¸ºè¯Šæ–­
é£é™©æ‰¿å—åº¦é‡è¡¨
ä¿¡æ¯æ¥æºå¯ä¿¡åº¦åˆ†æ
æŠ•èµ„è·¯å¾„æ¨è
å­¦ä¹ æ›²çº¿å®šä½

3.2 æ”¶æ•›ï¼ˆç ´å±€ç‚¹ä¸‰è¦ç´ ï¼‰
æ–¹å‘
å¹¿è°±
é«˜é¢‘
ä½“éªŒå¯æ§
ç»“è®º
æŠ•èµ„ç›²ç‚¹è¯Šæ–­
âœ”
âœ”
âœ”
ç ´å±€ç‚¹
MBTI/æ˜Ÿåº§äººæ ¼å…¥å£
âœ”
ä¸­
âœ”
è¾…åŠ©å…¥å£
å­¦ä¹ æ¨è
ä¸­
ä¸­
ä¸­
åæœŸå¼€å±•
å› æ­¤ MVP èšç„¦äºæŠ•èµ„ç›²ç‚¹è¯Šæ–­ + è½»é‡æ ‡ç­¾å…¥å£ã€‚

4. æ•´ä½“æµç¨‹ï¼ˆFlowï¼‰

4.1 ç”¨æˆ·ä¸»è·¯å¾„

é¦–é¡µï¼ˆä¸‰å…¥å£ï¼‰ â†’ é‚®ç®±å¼¹çª— â†’ å…¥å£åˆ†æµ â†’ é—®å· â†’ æäº¤ â†’ é‚®ä»¶æŠ¥å‘Š

æµç¨‹ç»†é¡¹ï¼š
ç”¨æˆ·æ‰“å¼€é¦–é¡µ
ä¸‰ä¸ªå…¥å£ï¼š
MBTI
æ˜Ÿåº§
Classic ä¸“ä¸šç‰ˆ
å…¥å£ç›®çš„ï¼šé™ä½å¿ƒæ™ºè´Ÿæ‹…ï¼Œæé«˜ç‚¹å‡»ç‡ï¼ˆå¿ƒç†ç ´å†°ï¼‰
ç‚¹å‡»ä»»ä¸€å…¥å£ â†’ å¼¹å‡ºé‚®ç®±å¡«å†™å¼¹çª—
é‚®ç®±ä¸ºå¼º gating
æ–‡æ¡ˆå¼ºè°ƒâ€œç”¨äºæ¥æ”¶å®Œæ•´è¯Šæ–­æŠ¥å‘Šâ€
ç”¨æˆ·å¡«å†™é‚®ç®±åè¿›å…¥å…¥å£åˆ†æµ
è‹¥é€‰ MBTI â†’ å±•ç¤º 16 MBTI é€‰é¡¹ â†’ è¿›å…¥é—®å·
è‹¥é€‰ æ˜Ÿåº§ â†’ å±•ç¤º 12 æ˜Ÿåº§é€‰é¡¹ â†’ è¿›å…¥é—®å·
è‹¥é€‰ Classic â†’ ç›´æ¥è¿›å…¥é—®å·
è¿›å…¥é—®å·ä¸»æµç¨‹
æ˜¾ç¤ºé—®å·æ ‡é¢˜ä¸ç®€çŸ­è¯´æ˜
å±•ç¤ºé¢˜ç›®ï¼ˆä½ æä¾›çš„å…¨éƒ¨ 20 + 1 å¼€æ”¾é¢˜ï¼‰
æ’åºé¢˜ï¼ˆç¬¬14é¢˜ï¼‰ç‰¹æ®Šäº¤äº’
ç”¨æˆ·ç‚¹å‡»æŸé¡¹ â†’ é¡¹ç›®ç§»å…¥æ’åºåŒºå¹¶ä»é€‰é¡¹åŒºæ¶ˆå¤±
ç›´åˆ°å…¨éƒ¨é€‰å®Œè‡ªåŠ¨è·³ä¸‹ä¸€é¢˜
é—®å·æäº¤æˆåŠŸ
å±•ç¤ºâ€œæ„Ÿè°¢å®Œæˆâ€é¡µé¢
ç”¨æˆ·å¯æŸ¥çœ‹â€œè½»é‡é¢„è§ˆç‰ˆâ€ç»“æœ
åŒæ—¶å®Œæ•´æŠ¥å‘Šå‘é€åˆ°é‚®ç®±

5. åŠŸèƒ½éœ€æ±‚è¯´æ˜ï¼ˆFRDï¼‰

5.1 é¦–é¡µä¸‰å…¥å£
å±•ç¤ºé†’ç›®å…¥å£åŒºå—ï¼ˆMBTI / æ˜Ÿåº§ / Classicï¼‰
ç‚¹å‡»ä»»æ„å…¥å£è§¦å‘é‚®ç®±å¼¹çª—
è®°å½•å…¥å£æ¥æºï¼ˆtraffic_sourceï¼‰

5.2 é‚®ç®±å¼¹çª—ï¼ˆå¼º gatingï¼‰
å­—æ®µï¼šemail
æ ¡éªŒï¼šæ ¼å¼æ ¡éªŒ + é‡å¤é‚®ç®±æç¤ºï¼ˆéé˜»å¡ï¼‰
CTAï¼šã€Œå¼€å§‹è¯Šæ–­ã€
GDPR/éšç§è¯´æ˜ï¼šæ¥å—åç»§ç»­æµç¨‹

5.3 MBTI/æ˜Ÿåº§é€‰æ‹©é¡µ

åŠŸèƒ½ç‚¹ï¼š
å±•ç¤º 16 MBTI å›¾æ ‡
å±•ç¤º 12 æ˜Ÿåº§å›¾æ ‡
ç‚¹å‡»åå†™å…¥ç”¨æˆ·å±æ€§ï¼ˆäººæ ¼/æ˜Ÿåº§æ ‡ç­¾ï¼‰

éç›®æ ‡ï¼ˆOut of Scopeï¼‰ï¼š
ä¸åš MBTI å†…å®¹è§£é‡Š
ä¸åšæ˜Ÿåº§è¿åŠ¿åˆ†æ

ç›®çš„åªåœ¨äº é™ä½è¿›å…¥é—®å·çš„å¿ƒç†æˆæœ¬ã€‚

5.4 é—®å·å¼•æ“ï¼ˆæ ¸å¿ƒï¼‰

æ”¯æŒé¢˜å‹ï¼š
é¢˜å‹
åŠŸèƒ½è¦æ±‚
å•é€‰é¢˜
å¿…ç­”ã€é€‰æ‹©å³é«˜äº®
å¤šé€‰é¢˜
æ”¯æŒâ€œå…¶ä»–â€æ–‡æœ¬æ¡†
æ’åºé¢˜
é€‰é¡¹ç‚¹å‡» â†’ ç§»å…¥å·²é€‰åŒº â†’ åŸé€‰é¡¹æ¶ˆå¤±ï¼›é€‰æ»¡è‡ªåŠ¨è·³ä¸‹ä¸€é¢˜
å¼€æ”¾é¢˜
æ”¯æŒé•¿æ–‡æœ¬è¾“å…¥
é—®å·æ•°æ®æŒ‰ JSON Schema å®šä¹‰ï¼ˆäº¤ç»™æŠ€æœ¯æ–‡æ¡£å®ç°ï¼‰ã€‚
é—®é¢˜å†…å®¹ç»†èŠ‚ï¼š
{
  "survey_name": "æŠ•èµ„è§‰å¯Ÿ Â· ç”¨æˆ·ç”»åƒä¸ç›²ç‚¹è¯Šæ–­ V2",
  "description": "è¿™ä¸æ˜¯ä¸€ä»½æ™®é€šé—®å·ï¼Œè€Œæ˜¯ä¸€åœºå…³äºä½ å½“å‰æŠ•èµ„çŠ¶æ€çš„è‡ªæˆ‘å¯¹è¯ã€‚",
  "questions": [
    {
      "id": 1,
      "type": "single_choice",
      "title": "ä»¥ä¸‹å“ªç§æè¿°ï¼Œæ›´è´´è¿‘ä½ ç°åœ¨æ‰€å¤„çš„äººç”Ÿé˜¶æ®µï¼Ÿâ€,ä½ çš„å¹´é¾„
      "options": [
        "åˆšèµ·æ­¥ï¼Œåœ¨æ‘¸ç´¢æ–¹å‘ï¼ˆ18-24ï¼‰,
        "åŸºæœ¬ç«™ç¨³ï¼Œå¼€å§‹è¿›é˜¶ï¼ˆ25â€“30ï¼‰â€,
        "è´£ä»»ä¸Šèº«ï¼Œè¿½æ±‚çªç ´ï¼ˆâ€31â€“40ï¼‰,
        "ç¨³å®šç§¯ç´¯ï¼Œç®¡ç†é£é™©ï¼ˆâ€41â€“50ï¼‰,
        "æ”¶å®˜å¸ƒå±€ï¼Œå®ˆæˆå¢å€¼"50+
      ],
      "touch": "ä½ ä¸æ˜¯åœ¨é€‰å¹´é¾„ï¼Œè€Œæ˜¯åœ¨é€‰æ­¤åˆ»çš„è‡ªå·±ã€‚"
    },

    {
      "id": 2,
      "type": "single_choice",
      "title": "ä½ çš„æ€§åˆ«æ˜¯ï¼Ÿ",
      "options": [
        "ç”·",
        "å¥³",
        "ä¸æ–¹ä¾¿é€éœ²"
      ]
    },

    {
      "id": 3,
      "type": "single_choice",
      "title": "å½“ä½ çš„æŒä»“çŸ­æœŸä¸‹è·Œ 15% æ—¶ï¼Œä½ æœ€å¯èƒ½çš„çœŸå®ååº”æ˜¯ï¼Ÿ",
      "options": [
        "æœ¬èƒ½æ­¢æŸï¼Œå…ˆä¿å‘½",
        "åå¤çŠ¹è±«ï¼Œç»§ç»­è§‚æœ›",
        "ç†æ€§åˆ†æï¼Œé€‚å½“åŠ ä»“",
        "æƒ…ç»ªå…´å¥‹ï¼Œå¤§å¹…åŠ æ³¨"
      ],
      "touch": "å‹åŠ›ä¹‹ä¸‹çš„ç¬¬ä¸€ååº”ï¼Œæ¯”ä»»ä½•æ€§æ ¼æ ‡ç­¾éƒ½è¯šå®ã€‚"
    },

    {
      "id": 4,
      "type": "single_choice",
      "title": "å¦‚æœåªèƒ½é€‰æ‹©ä¸€æ¡ä½ å½“å‰æœ€é‡è¦çš„æŠ•èµ„è·¯å¾„ï¼Œé‚£ä¼šæ˜¯ï¼Ÿ",
      "options": [
        "ç¨³ç¨³ç§¯ç´¯ï¼Œé•¿æœŸå¤åˆ©",
        "æé«˜æ”¶ç›Šï¼Œæ¥å—æ³¢åŠ¨",
        "ä¼˜å…ˆå…»è€å®‰å…¨",
        "å°½å¿«å®ç°è´¢åŠ¡è‡ªç”±",
        "å¯æŒç»­ç°é‡‘æµ",
        "è¿˜æ²¡æƒ³æ¸…æ¥š"
      ],
      "touch": "è¢«è¿«å•é€‰æ—¶ï¼Œä½ æ‰çŸ¥é“å†…å¿ƒçœŸæ­£è¦ä»€ä¹ˆã€‚"
    },

    {
      "id": 5,
      "type": "multiple_choice",
      "title": "ä½ ç°åœ¨ä¸»è¦å…³æ³¨æˆ–å‚ä¸çš„æŠ•èµ„é¢†åŸŸæœ‰å“ªäº›ï¼Ÿ",
      "options": [
        "è‚¡ç¥¨ / ETF",
        "åŸºé‡‘",
        "åŠ å¯†èµ„äº§",
        "æœŸè´§ / æœŸæƒ",
        "å…¶ä»–"
      ],
      "allow_other_text": true,
      "touch": "å…³æ³¨åœ¨å“ªé‡Œï¼Œé£é™©æ„Ÿåº”åŠ›å°±åœ¨å“ªé‡Œã€‚"
    },

    {
      "id": 6,
      "type": "single_choice",
      "title": "ä½ å½“å‰çš„æŠ•èµ„è§„æ¨¡ï¼Œæ›´è´´è¿‘å“ªä¸ªçŠ¶æ€ï¼Ÿ",
      "options": [
        "åˆšèµ·æ­¥è¯•æ°´",
        "æœ‰ä¸€å®šæœ¬é‡‘",
        "å¼€å§‹ç³»ç»Ÿå¸ƒå±€",
        "è§„æ¨¡åŒ–ç®¡ç†",
        "å·²è¿›å…¥èµ„äº§é…ç½®é˜¶æ®µ"
      ],
      "touch": "è§„æ¨¡ä¸ä»…æ˜¯æ•°å­—ï¼Œæ›´æ˜¯ä½ çš„æ“ä½œåŠå¾„ã€‚"
    },

    {
      "id": 7,
      "type": "single_choice",
      "title": "ä½ æ¥è§¦æŠ•èµ„å¸‚åœºå¤§æ¦‚æœ‰å¤šä¹…ï¼Ÿ",
      "options": [
        "ä¸åˆ° 1 å¹´",
        "1â€“3 å¹´",
        "3â€“5 å¹´",
        "5 å¹´ä»¥ä¸Š"
      ],
      "touch": "æ—¶é—´è¶Šé•¿ï¼Œè¶Šçœ‹å¾—å‡ºä½ èµ°è¿‡å“ªäº›å¼¯è·¯ã€‚"
    },

    {
      "id": 8,
      "type": "single_choice",
      "title": "ä½ é€šå¸¸å¤šä¹…ä¼šæŸ¥çœ‹è‡ªå·±çš„æŠ•èµ„æˆ–è¡Œæƒ…ï¼Ÿ",
      "options": [
        "ä¸€å¤©å¤šæ¬¡",
        "æ¯å¤©ä¸€æ¬¡",
        "æ¯å‘¨å‡ æ¬¡",
        "å¶å°”æ‰çœ‹"
      ],
      "touch": "æŸ¥çœ‹é¢‘ç‡ï¼Œå°±æ˜¯ä½ ä¸ä¸ç¡®å®šæ€§ç›¸å¤„çš„æ–¹å¼ã€‚"
    },

    {
      "id": 9,
      "type": "single_choice",
      "title": "å¯¹æ¯”ä¸‰å¹´å‰çš„è‡ªå·±ï¼Œä½ æ›´æ¥è¿‘å“ªç§å˜åŒ–ï¼Ÿ",
      "options": [
        "å¿ƒæ€æ˜æ˜¾æˆç†Ÿäº†",
        "æŠ€æœ¯è¿›æ­¥ï¼Œä½†æƒ…ç»ªæ²¡å˜",
        "å˜å¾—æ›´ç„¦è™‘",
        "æ›´ä½›ç³»ã€æ›´æ‘†çƒ‚",
        "è¯´ä¸ä¸Šæ¥"
      ],
      "touch": "æŠ•èµ„æˆé•¿ï¼Œé¦–å…ˆæ˜¯å¿ƒæ™ºæˆé•¿ã€‚"
    },

    {
      "id": 10,
      "type": "multiple_choice",
      "title": "å½“ä½ çŠ¹è±«æ˜¯å¦æ“ä½œæ—¶ï¼Œæœ€å®¹æ˜“å¡ä½ä½ çš„çœŸå®éšœç¢æ˜¯ï¼Ÿ",
      "options": [
        "æ€•äºæŸ â†’ ä¸æ•¢ä¸‹æ‰‹",
        "æ€•é”™è¿‡ â†’ å†²åŠ¨è¿½é«˜",
        "ä¿¡æ¯å¤ªå¤š â†’ æ— æ³•åˆ¤æ–­",
        "ä¸ä¼šæ‹©æ—¶ â†’ ä¸€æ‹–å†æ‹–",
        "è¿‡å»äºè¿‡ â†’ å¿ƒæ€å˜å½¢",
        "å¯¹è‡ªå·±æ²¡ä¿¡å¿ƒ â†’ è·Ÿé£æ“ä½œ"
      ],
      "touch": "ä½ å¡ä½çš„åœ°æ–¹ï¼Œå°±æ˜¯ä½ çš„æŠ•èµ„ç›²åŒºã€‚"
    },

    {
      "id": 11,
      "type": "multiple_choice",
      "title": "ä½ ä¸»è¦ä¾èµ–å“ªäº›ä¿¡æ¯æ¥æºåšå†³ç­–ï¼Ÿ",
      "options": [
        "ç¤¾äº¤åª’ä½“è§‚ç‚¹",
        "KOL / ä¸»æ’­",
        "è‡ªå·±ç³»ç»Ÿç ”ç©¶",
        "æœ‹å‹æ¨è",
        "æœºæ„ç ”æŠ¥",
        "AI / æ™ºèƒ½å·¥å…·"
      ],
      "allow_other_text": true,
      "other_placeholder": "å¯å¡«å†™å…·ä½“å…³æ³¨çš„è´¦å·æˆ–ç½‘ç«™â€è¿™é‡ŒåŠ ä¸€å¥æˆ‘ä»¬ä¼šåŸºäºä½ çš„ç”»åƒåŒ¹é…å­¦ä¹ å¯¹è±¡æ˜¯å¦å½“å‰æœ€ä¼˜é€‰æ‹©ï¼Œplease notice we only provide analysis, without suggestion,
      "touch": "ä½ ä¿¡ä»€ä¹ˆï¼Œå†³å®šä½ æ€ä¹ˆçœ‹ä¸–ç•Œã€‚"
    },

    {
      "id": 12,
      "type": "single_choice",
      "title": "æ‰€è°“å›æ’¤æ˜¯æŒ‡ï¼š\nè´¦æˆ·æµ®äºåˆ°ä¸€å®šç¨‹åº¦æ—¶ï¼Œä½ è¿˜ç¡å¾—ç€è§‰å—ï¼Ÿ\nä½ å¯ä»¥æ¥å—çš„æœ€å¤§çŸ­æœŸå›æ’¤æ˜¯ï¼Ÿ",
      "options": [
        "5%",
        "10%",
        "20%",
        "30% ä»¥ä¸Š"
      ],
      "touch": "å›æ’¤é˜ˆå€¼ï¼Œå°±æ˜¯ä½ çš„å¿ƒç†å®‰å…¨è¾¹ç•Œã€‚"
    },

    {
      "id": 13,
      "type": "multiple_choice",
      "title": "ä½ å½“å‰å®é™…æŒæœ‰çš„èµ„äº§ç±»å‹æœ‰ï¼Ÿ",
      "options": [
        "ç°é‡‘",
        "è‚¡ç¥¨ / ETF",
        "åŸºé‡‘",
        "åŠ å¯†èµ„äº§",
        "å€ºåˆ¸ / å›ºæ”¶",
        "å…¶ä»–"
      ],
      "allow_other_text": true,
      "touch": "æŒä»“æ¯”è¯­è¨€æ›´è¯šå®ã€‚"
    },

    {
      "id": 14,
      "type": "ranking",
      "title": "å½“ä»¥ä¸‹ä»·å€¼ä¸å¯å…¼å¾—æ—¶ï¼Œè¯·æŒ‰ä½ çœŸå®å–èˆé¡ºåºæ’åº",
      "options": [
        "æ”¶ç›Š",
        "é£é™©æ§åˆ¶",
        "æµåŠ¨æ€§",
        "å­¦ä¹ ä¸æˆé•¿",
        "è´¢å¯Œç¨³å®šæ„Ÿ"
      ],
      "touch": "æ¯ä¸€æ¬¡æ’åºï¼Œéƒ½æ˜¯å’Œå†…å¿ƒä»·å€¼çš„å¯¹è¯ã€‚"
    }, è¿™é‡Œäº¤äº’æ˜¯é€‰ä¸€é¡¹ï¼Œæ¶ˆå¤±ä¸€é¡¹ï¼Œå…¨éƒ¨ç‚¹å®Œå°±è·³è½¬åˆ°ä¸‹ä¸€é¢˜ï¼Œ

    {
      "id": 15,
      "type": "single_choice",
      "title": "ä½ çš„ä¸»è¦æ”¶å…¥æ¥æºæ›´æ¥è¿‘å“ªä¸€ç§ï¼Ÿ",
      "options": [
        "å·¥èµ„",
        "åˆ›ä¸š / è‡ªç”±èŒä¸š",
        "æŠ•èµ„æ”¶ç›Š",
        "å®¶åº­æ”¯æŒ",
        "å…¶ä»–"
      ],
      "touch": "æ”¶å…¥ç»“æ„å†³å®šä½ çš„å®‰å…¨å«åšåº¦ã€‚"
    },

    {
      "id": 16,
      "type": "single_choice",
      "title": "ä½ ç†æƒ³çš„æŠ•èµ„èŠ‚å¥æ›´æ¥è¿‘ï¼Ÿ",
      "options": [
        "ç¨³ç¨³å‘ä¸Š",
        "å¯æ¥å—æ³¢åŠ¨",
        "æ„¿æ‰¿å—è¾ƒå¤§æ³¢åŠ¨",
        "çƒ­ç‚¹è¿›å‡ºå‹"
      ],
      "touch": "æŠ•èµ„èŠ‚å¥ï¼Œå¾€å¾€æ˜ å°„äººç”ŸèŠ‚å¥ã€‚"
    },

    {
      "id": 17,
      "type": "single_choice",
      "title": "ä½ æ„¿æ„ä¸ºæŠ•èµ„æŒç»­æŠ•å…¥çš„æ—¶é—´å¤§æ¦‚æ˜¯ï¼Ÿ",
      "options": [
        "æ¯å¤© 1 å°æ—¶ä»¥ä¸Š",
        "æ¯å¤© 10â€“30 åˆ†é’Ÿ",
        "æ¯å‘¨ 1 å°æ—¶",
        "è¶Šå°‘è¶Šå¥½ï¼Œé‡åœ¨ç»“æœ"
      ],
      "touch": "æ—¶é—´æŠ•å…¥ï¼Œå°±æ˜¯ä½ å¯¹æœªæ¥çš„ä¸‹æ³¨æ¯”ä¾‹ã€‚"
    },

    {
      "id": 18,
      "type": "single_choice",
      "title": "ä½ å¯¹æ™ºèƒ½æŠ•èµ„/è‡ªåŠ¨åŒ–å·¥å…·çš„æ€åº¦æ˜¯ï¼Ÿ",
      "options": [
        "éå¸¸æ„¿æ„ä½¿ç”¨",
        "æ„¿æ„å°è¯•",
        "ä¸å¤ªæ„¿æ„",
        "ä¸ä¼šä½¿ç”¨"
      ],
      "touch": "ä½ æ˜¯å¦æ„¿æ„æŠŠéƒ¨åˆ†æ§åˆ¶æƒäº¤ç»™ç³»ç»Ÿï¼Ÿ"
    },

    {
      "id": 19,
      "type": "multiple_choice",
      "title": "ä½ æœ€å¸Œæœ›è·å¾—å“ªç±»æŠ•èµ„æ”¯æŒï¼Ÿ",
      "options": [
        "æ¸…æ™°çš„ä¹°å–å‚è€ƒ",
        "ç³»ç»ŸåŒ–æ–¹æ³•æ¡†æ¶",
        "èµ„äº§é…ç½®é€»è¾‘",
        "æƒ…ç»ªç®¡ç†é™ªä¼´",
        "çƒ­ç‚¹è¿½è¸ªè§£è¯»",
        "æŠ•èµ„è€…ç¤¾ç¾¤"
      ],
      "touch": "ä½ æ¸´æœ›çš„æ”¯æŒï¼Œæ­£æ˜¯ä½ æƒ³è·¨è¶Šçš„å…³å£ã€‚"
    },

    {
      "id": 20,
      "type": "single_choice",
      "title": "ä½ å¯¹å½“å‰æŠ•èµ„ä½“éªŒæœ€ä¸æ»¡æ„çš„æ˜¯ï¼Ÿ",
      "options": [
        "ä¿¡æ¯å¤ªæ‚ä¹±",
        "å†…å®¹éš¾ç†è§£",
        "å†³ç­–æ²¡ä¾æ®",
        "å·¥å…·å¤ªå¤æ‚",
        "æ”¶ç›Šä¸ç¨³å®š",
        "ç¼ºä¹æˆé•¿æŒ‡å¼•"
      ],
      "touch": "æœ€çœŸå®çš„ç—›ç‚¹ï¼Œå¾€å¾€æŒ‡å‘ä½ ä¸‹ä¸€æ­¥çš„çªç ´å£ã€‚"
    }
  ]
{
  "id": 21,
  "type": "open_text",
  "title": "å¦‚æœåªèƒ½é—®ä½ ä¸€å¥ï¼šä½ ç°åœ¨åœ¨æŠ•èµ„ä¸Šï¼Œæœ€æƒ³è§£å†³çš„â€œå¡ç‚¹â€æ˜¯ä»€ä¹ˆï¼Ÿ",
  "placeholder": "æ¯”å¦‚ï¼šä¸çŸ¥é“æ€ä¹ˆä¹°å–ã€å¿ƒæ€åŠ¨ä¸åŠ¨å°±å´©ã€æ€»è·Ÿé£ã€æ²¡æ—¶é—´å­¦ã€èµ„é‡‘å¤ªå°‘ç­‰â€¦â€¦å¯ä»¥éšä¾¿èŠå‡ å¥",
  "touch": "ä½ æ„¿æ„è®¤çœŸå†™ä¸‹çš„é—®é¢˜ï¼Œé€šå¸¸å·²ç»åœ¨ä½ å¿ƒé‡Œå‘é…µå¾ˆä¹…äº†ã€‚"
}



5.5 é—®å·æäº¤
å‰ç«¯æ ¡éªŒå¿…å¡«é¡¹
åç«¯è½åº“é—®å·ç­”æ¡ˆ
è°ƒç”¨åˆ†æAIå®æ—¶ç”ŸæˆæŠ¥å‘Š
å¼•å¯¼ç”¨æˆ·åŸºäºæŠ¥å‘Šç•™ä¸‹åé¦ˆï¼Œæˆ–è€…æ˜¯å¦è¿›ä¸€æ­¥æ¥è§¦äº†è§£æ›´å¤šï¼Œæ³¨æ˜å…¬ç›Šé¡¹ç›®ä¸æ”¶è´¹


TRD - æŠ•èµ„è§‰å¯ŸÂ·ç”¨æˆ·ç”»åƒä¸ç›²ç‚¹è¯Šæ–­ V2
Technical Requirements Document

æ–‡æ¡£ä¿¡æ¯
é¡¹ç›®åç§°ï¼š æŠ•èµ„è§‰å¯ŸÂ·ç”¨æˆ·ç”»åƒä¸ç›²ç‚¹è¯Šæ–­ V2
ç‰ˆæœ¬ï¼š v1.0
åˆ›å»ºæ—¥æœŸï¼š 2024-12-10
æŠ€æœ¯è´Ÿè´£äººï¼š [æŠ€æœ¯è´Ÿè´£äºº]
çŠ¶æ€ï¼š Ready for Development

ä¸€ã€æŠ€æœ¯æ¶æ„æ€»è§ˆ
1.1 æ•´ä½“æ¶æ„å›¾
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        å‰ç«¯å±‚ï¼ˆFrontendï¼‰                     â”‚
â”‚  Next.js 14 + React + TailwindCSS                           â”‚
â”‚  â”œâ”€ é¦–é¡µï¼ˆä¸‰å…¥å£ï¼šMBTI/æ˜Ÿåº§/Classicï¼‰                        â”‚
â”‚  â”œâ”€ é‚®ç®±æ”¶é›†å¼¹çª—                                              â”‚
â”‚  â”œâ”€ å…¥å£åˆ†æµé¡µï¼ˆMBTI/æ˜Ÿåº§é€‰æ‹©ï¼‰                              â”‚
â”‚  â”œâ”€ é—®å·å¼•æ“ï¼ˆå•é€‰/å¤šé€‰/æ’åº/å¼€æ”¾é¢˜ï¼‰                         â”‚
â”‚  â””â”€ ç»“æœé¢„è§ˆé¡µ                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“ HTTPS/REST API
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      åç«¯APIå±‚ï¼ˆBackendï¼‰                     â”‚
â”‚  Node.js 18+ + Express + Prisma                             â”‚
â”‚  â”œâ”€ ç”¨æˆ·ç®¡ç† API                                             â”‚
â”‚  â”œâ”€ é—®å·æäº¤ API                                             â”‚
â”‚  â”œâ”€ AIåˆ†æè°ƒåº¦                                               â”‚
â”‚  â””â”€ é‚®ä»¶å‘é€æœåŠ¡                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â†“                           â†“                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  PostgreSQL  â”‚          â”‚  Dify AI API â”‚    â”‚ Email Serviceâ”‚
â”‚  - users     â”‚          â”‚  (åˆ†æå¼•æ“)   â”‚    â”‚ (Resend/SES) â”‚
â”‚  - responses â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚  - reports   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
1.2 æŠ€æœ¯æ ˆé€‰æ‹©
å‰ç«¯
æŠ€æœ¯
ç‰ˆæœ¬
ç”¨é€”
Next.js
14+
Reactæ¡†æ¶ï¼Œæ”¯æŒSSR
React
18+
UIç»„ä»¶
TypeScript
5+
ç±»å‹å®‰å…¨
TailwindCSS
3+
æ ·å¼
Zustand
4+
çŠ¶æ€ç®¡ç†
React Hook Form
7+
è¡¨å•å¤„ç†
Framer Motion
10+
åŠ¨ç”»ï¼ˆå¯é€‰ï¼‰
åç«¯
æŠ€æœ¯
ç‰ˆæœ¬
ç”¨é€”
Node.js
18 LTS
è¿è¡Œæ—¶
Express
4+
Webæ¡†æ¶
Prisma
5+
ORM
PostgreSQL
15+
æ•°æ®åº“
Zod
3+
æ•°æ®éªŒè¯
Resend
Latest
é‚®ä»¶æœåŠ¡

äºŒã€æ•°æ®åº“è®¾è®¡
2.1 ERå›¾
users (ç”¨æˆ·è¡¨)
  â”œâ”€ id (PK)
  â”œâ”€ email (unique)
  â”œâ”€ entry_point (MBTI/æ˜Ÿåº§/Classic)
  â”œâ”€ mbti_type (å¯é€‰)
  â”œâ”€ zodiac_sign (å¯é€‰)
  â””â”€ created_at

survey_responses (é—®å·å›ç­”è¡¨)
  â”œâ”€ id (PK)
  â”œâ”€ user_id (FK â†’ users)
  â”œâ”€ session_id (UUID)
  â”œâ”€ question_id
  â”œâ”€ answer (JSONB)
  â””â”€ answered_at

analysis_reports (åˆ†ææŠ¥å‘Šè¡¨)
  â”œâ”€ id (PK)
  â”œâ”€ user_id (FK â†’ users)
  â”œâ”€ session_id (UUID)
  â”œâ”€ report_content (JSONB)
  â”œâ”€ status (generating/completed/failed)
  â”œâ”€ email_sent (boolean)
  â””â”€ generated_at
2.2 Prisma Schema
prisma
// schema.prisma

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ç”¨æˆ·è¡¨
model User {
  id          String   @id @default(uuid())
  email       String   @unique
  entryPoint  EntryPoint @map("entry_point") // å…¥å£æ¥æº
  mbtiType    String?  @map("mbti_type")     // MBTIç±»å‹ï¼ˆå¯é€‰ï¼‰
  zodiacSign  String?  @map("zodiac_sign")   // æ˜Ÿåº§ï¼ˆå¯é€‰ï¼‰
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")
  
  responses SurveyResponse[]
  reports   AnalysisReport[]
  
  @@index([email])
  @@map("users")
}

enum EntryPoint {
  MBTI
  ZODIAC
  CLASSIC
}

// é—®å·å›ç­”è¡¨
model SurveyResponse {
  id         String   @id @default(uuid())
  userId     String   @map("user_id")
  sessionId  String   @map("session_id")
  questionId Int      @map("question_id")
  answer     Json     // æ”¯æŒå„ç§ç­”æ¡ˆç±»å‹
  answeredAt DateTime @default(now()) @map("answered_at")
  
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  @@unique([sessionId, questionId]) // ç¡®ä¿åŒä¸€sessionåŒä¸€é¢˜åªèƒ½ç­”ä¸€æ¬¡
  @@index([userId])
  @@index([sessionId])
  @@map("survey_responses")
}

// åˆ†ææŠ¥å‘Šè¡¨
model AnalysisReport {
  id            String   @id @default(uuid())
  userId        String   @map("user_id")
  sessionId     String   @unique @map("session_id")
  reportContent Json     @map("report_content") // AIç”Ÿæˆçš„å®Œæ•´æŠ¥å‘Š
  previewContent Json?   @map("preview_content") // è½»é‡é¢„è§ˆç‰ˆ
  status        ReportStatus @default(GENERATING)
  emailSent     Boolean  @default(false) @map("email_sent")
  errorMessage  String?  @map("error_message")
  generatedAt   DateTime @default(now()) @map("generated_at")
  
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  @@index([userId])
  @@index([sessionId])
  @@map("analysis_reports")
}

enum ReportStatus {
  GENERATING
  COMPLETED
  FAILED
}
2.3 æ•°æ®åº“è¿ç§»å‘½ä»¤
bash
# åˆ›å»ºè¿ç§»
npx prisma migrate dev --name init

# ç”ŸæˆPrisma Client
npx prisma generate

# æŸ¥çœ‹æ•°æ®åº“
npx prisma studio

ä¸‰ã€APIè®¾è®¡è§„èŒƒ
3.1 APIåŸºç¡€è§„èŒƒ
Base URL: https://api.investmentawareness.com/api/v1
é€šç”¨å“åº”æ ¼å¼ï¼š
typescript
interface ApiResponse<T> {
  success: boolean;
  data?: T;
  error?: {
    code: string;
    message: string;
    details?: any;
  };
  timestamp: string;
}
3.2 APIç«¯ç‚¹è¯¦ç»†è®¾è®¡
ç«¯ç‚¹1ï¼šåˆ›å»ºç”¨æˆ·ä¼šè¯
åŠŸèƒ½ï¼š ç”¨æˆ·å¡«å†™é‚®ç®±ååˆ›å»ºä¼šè¯
http
POST /api/v1/users/create
Content-Type: application/json

è¯·æ±‚ä½“ï¼š
{
  "email": "user@example.com",
  "entryPoint": "MBTI" | "ZODIAC" | "CLASSIC"
}

å“åº”ï¼ˆ201 Createdï¼‰ï¼š
{
  "success": true,
  "data": {
    "userId": "uuid-string",
    "sessionId": "uuid-string",
    "email": "user@example.com",
    "entryPoint": "MBTI",
    "createdAt": "2024-12-10T10:00:00Z"
  }
}

é”™è¯¯å“åº”ï¼ˆ400 Bad Requestï¼‰ï¼š
{
  "success": false,
  "error": {
    "code": "INVALID_EMAIL",
    "message": "é‚®ç®±æ ¼å¼ä¸æ­£ç¡®"
  }
}
å®ç°è¦ç‚¹ï¼š
é‚®ç®±æ ¼å¼éªŒè¯
æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨ï¼ˆå·²å­˜åœ¨åˆ™è¿”å›ç°æœ‰userIdï¼‰
ç”ŸæˆsessionIdç”¨äºé—®å·è¿½è¸ª
è®°å½•å…¥å£æ¥æº

ç«¯ç‚¹2ï¼šæ›´æ–°ç”¨æˆ·æ ‡ç­¾ï¼ˆMBTI/æ˜Ÿåº§ï¼‰
åŠŸèƒ½ï¼š ç”¨æˆ·é€‰æ‹©MBTIæˆ–æ˜Ÿåº§åæ›´æ–°
http
PATCH /api/v1/users/:userId/tags
Content-Type: application/json

è¯·æ±‚ä½“ï¼ˆMBTIï¼‰ï¼š
{
  "mbtiType": "INTJ"
}

è¯·æ±‚ä½“ï¼ˆæ˜Ÿåº§ï¼‰ï¼š
{
  "zodiacSign": "æ‘©ç¾¯åº§"
}

å“åº”ï¼ˆ200 OKï¼‰ï¼š
{
  "success": true,
  "data": {
    "userId": "uuid-string",
    "mbtiType": "INTJ",
    "zodiacSign": null
  }
}
å®ç°è¦ç‚¹ï¼š
éªŒè¯MBTIç±»å‹ï¼ˆ16ç§ï¼‰
éªŒè¯æ˜Ÿåº§ï¼ˆ12ç§ï¼‰
åªæ›´æ–°éç©ºå­—æ®µ

ç«¯ç‚¹3ï¼šæäº¤å•ä¸ªé—®é¢˜ç­”æ¡ˆï¼ˆå®æ—¶ä¿å­˜ï¼‰
åŠŸèƒ½ï¼š æ¯ä¸ªé—®é¢˜å›ç­”åç«‹å³ä¿å­˜
http
POST /api/v1/survey/answer
Content-Type: application/json

è¯·æ±‚ä½“ï¼š
{
  "userId": "uuid-string",
  "sessionId": "uuid-string",
  "questionId": 1,
  "answer": {
    "type": "single_choice",
    "value": "åŸºæœ¬ç«™ç¨³ï¼Œå¼€å§‹è¿›é˜¶ï¼ˆ25â€“30ï¼‰"
  }
}

å“åº”ï¼ˆ200 OKï¼‰ï¼š
{
  "success": true,
  "message": "ç­”æ¡ˆå·²ä¿å­˜"
}
ä¸åŒé¢˜å‹çš„answeræ ¼å¼ï¼š
typescript
// å•é€‰é¢˜
{
  "type": "single_choice",
  "value": "é€‰é¡¹æ–‡æœ¬"
}

// å¤šé€‰é¢˜
{
  "type": "multiple_choice",
  "values": ["é€‰é¡¹1", "é€‰é¡¹2"],
  "otherText": "è‡ªå®šä¹‰æ–‡æœ¬" // å¯é€‰
}

// æ’åºé¢˜
{
  "type": "ranking",
  "rankedValues": [
    { "order": 1, "value": "æ”¶ç›Š" },
    { "order": 2, "value": "é£é™©æ§åˆ¶" },
    { "order": 3, "value": "æµåŠ¨æ€§" },
    { "order": 4, "value": "å­¦ä¹ ä¸æˆé•¿" },
    { "order": 5, "value": "è´¢å¯Œç¨³å®šæ„Ÿ" }
  ]
}

// å¼€æ”¾é¢˜
{
  "type": "open_text",
  "value": "ç”¨æˆ·è¾“å…¥çš„é•¿æ–‡æœ¬..."
}
å®ç°è¦ç‚¹ï¼š
ä½¿ç”¨UPSERTæ“ä½œï¼ˆå­˜åœ¨åˆ™æ›´æ–°ï¼‰
éªŒè¯questionIdåˆæ³•æ€§ï¼ˆ1-21ï¼‰
éªŒè¯answerç»“æ„
å¼‚æ­¥å¤„ç†ï¼Œå¿«é€Ÿå“åº”

ç«¯ç‚¹4ï¼šæäº¤å®Œæ•´é—®å·
åŠŸèƒ½ï¼š ç”¨æˆ·å®Œæˆæ‰€æœ‰é—®é¢˜åæäº¤ï¼Œè§¦å‘AIåˆ†æ
http
POST /api/v1/survey/submit
Content-Type: application/json

è¯·æ±‚ä½“ï¼š
{
  "userId": "uuid-string",
  "sessionId": "uuid-string"
}

å“åº”ï¼ˆ202 Acceptedï¼‰ï¼š
{
  "success": true,
  "data": {
    "sessionId": "uuid-string",
    "status": "generating",
    "message": "é—®å·å·²æäº¤ï¼Œæ­£åœ¨ç”Ÿæˆåˆ†ææŠ¥å‘Š"
  }
}
å®ç°è¦ç‚¹ï¼š
éªŒè¯æ‰€æœ‰å¿…å¡«é¢˜å·²å›ç­”
åˆ›å»ºåˆ†ææŠ¥å‘Šè®°å½•ï¼ˆçŠ¶æ€ï¼šgeneratingï¼‰
å¼‚æ­¥è°ƒç”¨Dify APIç”ŸæˆæŠ¥å‘Š
ç«‹å³è¿”å›202çŠ¶æ€ï¼ˆä¸ç­‰å¾…AIå®Œæˆï¼‰

ç«¯ç‚¹5ï¼šè·å–åˆ†ææŠ¥å‘Š
åŠŸèƒ½ï¼š æŸ¥è¯¢æŠ¥å‘Šç”ŸæˆçŠ¶æ€åŠå†…å®¹
http
GET /api/v1/report/:sessionId

å“åº”ï¼ˆ200 OK - æŠ¥å‘Šå·²ç”Ÿæˆï¼‰ï¼š
{
  "success": true,
  "data": {
    "sessionId": "uuid-string",
    "status": "completed",
    "previewContent": {
      "summary": "åŸºäºæ‚¨çš„å›ç­”ï¼Œæ‚¨çš„æŠ•èµ„é£æ ¼å€¾å‘äº...",
      "keyInsights": [
        "æ‚¨å¯¹é£é™©çš„æ‰¿å—èƒ½åŠ›è¾ƒå¼º",
        "æ‚¨åå¥½ä¸»åŠ¨å‹æŠ•èµ„ç­–ç•¥"
      ]
    },
    "fullReportEmailSent": true,
    "generatedAt": "2024-12-10T10:05:00Z"
  }
}

å“åº”ï¼ˆ202 Accepted - æŠ¥å‘Šç”Ÿæˆä¸­ï¼‰ï¼š
{
  "success": true,
  "data": {
    "sessionId": "uuid-string",
    "status": "generating",
    "message": "æŠ¥å‘Šæ­£åœ¨ç”Ÿæˆä¸­ï¼Œé¢„è®¡1-2åˆ†é’Ÿ"
  }
}

å“åº”ï¼ˆ500 Internal Server Error - ç”Ÿæˆå¤±è´¥ï¼‰ï¼š
{
  "success": false,
  "error": {
    "code": "GENERATION_FAILED",
    "message": "æŠ¥å‘Šç”Ÿæˆå¤±è´¥ï¼Œè¯·é‡è¯•"
  }
}
å®ç°è¦ç‚¹ï¼š
æ”¯æŒè½®è¯¢æŸ¥è¯¢
è¿”å›è½»é‡é¢„è§ˆç‰ˆï¼ˆå‰ç«¯å±•ç¤ºï¼‰
å®Œæ•´æŠ¥å‘Šä»…é€šè¿‡é‚®ä»¶å‘é€

ç«¯ç‚¹6ï¼šé‡æ–°ç”ŸæˆæŠ¥å‘Šï¼ˆå¯é€‰ï¼‰
åŠŸèƒ½ï¼š ç”¨æˆ·å¯è¯·æ±‚é‡æ–°ç”ŸæˆæŠ¥å‘Š
http
POST /api/v1/report/:sessionId/regenerate

å“åº”ï¼ˆ202 Acceptedï¼‰ï¼š
{
  "success": true,
  "message": "å·²å¼€å§‹é‡æ–°ç”ŸæˆæŠ¥å‘Š"
}

å››ã€é—®å·æ•°æ®ç»“æ„è®¾è®¡
4.1 é—®å·JSON Schema
typescript
// types/survey.ts

export interface SurveyQuestion {
  id: number;
  type: 'single_choice' | 'multiple_choice' | 'ranking' | 'open_text';
  title: string;
  options?: string[];
  allowOtherText?: boolean;
  otherPlaceholder?: string;
  touch?: string; // é—®é¢˜å¼•å¯¼è¯­
  required?: boolean;
}

export interface Survey {
  surveyName: string;
  description: string;
  questions: SurveyQuestion[];
}
4.2 å®Œæ•´é—®å·é…ç½®
typescript
// config/survey.ts

export const INVESTMENT_SURVEY: Survey = {
  surveyName: "æŠ•èµ„è§‰å¯Ÿ Â· ç”¨æˆ·ç”»åƒä¸ç›²ç‚¹è¯Šæ–­ V2",
  description: "è¿™ä¸æ˜¯ä¸€ä»½æ™®é€šé—®å·ï¼Œè€Œæ˜¯ä¸€åœºå…³äºä½ å½“å‰æŠ•èµ„çŠ¶æ€çš„è‡ªæˆ‘å¯¹è¯ã€‚",
  questions: [
    {
      id: 1,
      type: "single_choice",
      title: "ä»¥ä¸‹å“ªç§æè¿°ï¼Œæ›´è´´è¿‘ä½ ç°åœ¨æ‰€å¤„çš„äººç”Ÿé˜¶æ®µï¼Ÿ",
      options: [
        "åˆšèµ·æ­¥ï¼Œåœ¨æ‘¸ç´¢æ–¹å‘ï¼ˆ18-24ï¼‰",
        "åŸºæœ¬ç«™ç¨³ï¼Œå¼€å§‹è¿›é˜¶ï¼ˆ25â€“30ï¼‰",
        "è´£ä»»ä¸Šèº«ï¼Œè¿½æ±‚çªç ´ï¼ˆ31â€“40ï¼‰",
        "ç¨³å®šç§¯ç´¯ï¼Œç®¡ç†é£é™©ï¼ˆ41â€“50ï¼‰",
        "æ”¶å®˜å¸ƒå±€ï¼Œå®ˆæˆå¢å€¼ï¼ˆ50+ï¼‰"
      ],
      touch: "ä½ ä¸æ˜¯åœ¨é€‰å¹´é¾„ï¼Œè€Œæ˜¯åœ¨é€‰æ­¤åˆ»çš„è‡ªå·±ã€‚",
      required: true
    },
    {
      id: 2,
      type: "single_choice",
      title: "ä½ çš„æ€§åˆ«æ˜¯ï¼Ÿ",
      options: [
        "ç”·",
        "å¥³",
        "ä¸æ–¹ä¾¿é€éœ²"
      ],
      required: true
    },
    {
      id: 3,
      type: "single_choice",
      title: "å½“ä½ çš„æŒä»“çŸ­æœŸä¸‹è·Œ 15% æ—¶ï¼Œä½ æœ€å¯èƒ½çš„çœŸå®ååº”æ˜¯ï¼Ÿ",
      options: [
        "æœ¬èƒ½æ­¢æŸï¼Œå…ˆä¿å‘½",
        "åå¤çŠ¹è±«ï¼Œç»§ç»­è§‚æœ›",
        "ç†æ€§åˆ†æï¼Œé€‚å½“åŠ ä»“",
        "æƒ…ç»ªå…´å¥‹ï¼Œå¤§å¹…åŠ æ³¨"
      ],
      touch: "å‹åŠ›ä¹‹ä¸‹çš„ç¬¬ä¸€ååº”ï¼Œæ¯”ä»»ä½•æ€§æ ¼æ ‡ç­¾éƒ½è¯šå®ã€‚",
      required: true
    },
    {
      id: 4,
      type: "single_choice",
      title: "å¦‚æœåªèƒ½é€‰æ‹©ä¸€æ¡ä½ å½“å‰æœ€é‡è¦çš„æŠ•èµ„è·¯å¾„ï¼Œé‚£ä¼šæ˜¯ï¼Ÿ",
      options: [
        "ç¨³ç¨³ç§¯ç´¯ï¼Œé•¿æœŸå¤åˆ©",
        "æé«˜æ”¶ç›Šï¼Œæ¥å—æ³¢åŠ¨",
        "ä¼˜å…ˆå…»è€å®‰å…¨",
        "å°½å¿«å®ç°è´¢åŠ¡è‡ªç”±",
        "å¯æŒç»­ç°é‡‘æµ",
        "è¿˜æ²¡æƒ³æ¸…æ¥š"
      ],
      touch: "è¢«è¿«å•é€‰æ—¶ï¼Œä½ æ‰çŸ¥é“å†…å¿ƒçœŸæ­£è¦ä»€ä¹ˆã€‚",
      required: true
    },
    {
      id: 5,
      type: "multiple_choice",
      title: "ä½ ç°åœ¨ä¸»è¦å…³æ³¨æˆ–å‚ä¸çš„æŠ•èµ„é¢†åŸŸæœ‰å“ªäº›ï¼Ÿ",
      options: [
        "è‚¡ç¥¨ / ETF",
        "åŸºé‡‘",
        "åŠ å¯†èµ„äº§",
        "æœŸè´§ / æœŸæƒ",
        "å…¶ä»–"
      ],
      allowOtherText: true,
      touch: "å…³æ³¨åœ¨å“ªé‡Œï¼Œé£é™©æ„Ÿåº”åŠ›å°±åœ¨å“ªé‡Œã€‚",
      required: true
    },
    {
      id: 6,
      type: "single_choice",
      title: "ä½ å½“å‰çš„æŠ•èµ„è§„æ¨¡ï¼Œæ›´è´´è¿‘å“ªä¸ªçŠ¶æ€ï¼Ÿ",
      options: [
        "åˆšèµ·æ­¥è¯•æ°´",
        "æœ‰ä¸€å®šæœ¬é‡‘",
        "å¼€å§‹ç³»ç»Ÿå¸ƒå±€",
        "è§„æ¨¡åŒ–ç®¡ç†",
        "å·²è¿›å…¥èµ„äº§é…ç½®é˜¶æ®µ"
      ],
      touch: "è§„æ¨¡ä¸ä»…æ˜¯æ•°å­—ï¼Œæ›´æ˜¯ä½ çš„æ“ä½œåŠå¾„ã€‚",
      required: true
    },
    {
      id: 7,
      type: "single_choice",
      title: "ä½ æ¥è§¦æŠ•èµ„å¸‚åœºå¤§æ¦‚æœ‰å¤šä¹…ï¼Ÿ",
      options: [
        "ä¸åˆ° 1 å¹´",
        "1â€“3 å¹´",
        "3â€“5 å¹´",
        "5 å¹´ä»¥ä¸Š"
      ],
      touch: "æ—¶é—´è¶Šé•¿ï¼Œè¶Šçœ‹å¾—å‡ºä½ èµ°è¿‡å“ªäº›å¼¯è·¯ã€‚",
      required: true
    },
    {
      id: 8,
      type: "single_choice",
      title: "ä½ é€šå¸¸å¤šä¹…ä¼šæŸ¥çœ‹è‡ªå·±çš„æŠ•èµ„æˆ–è¡Œæƒ…ï¼Ÿ",
      options: [
        "ä¸€å¤©å¤šæ¬¡",
        "æ¯å¤©ä¸€æ¬¡",
        "æ¯å‘¨å‡ æ¬¡",
        "å¶å°”æ‰çœ‹"
      ],
      touch: "æŸ¥çœ‹é¢‘ç‡ï¼Œå°±æ˜¯ä½ ä¸ä¸ç¡®å®šæ€§ç›¸å¤„çš„æ–¹å¼ã€‚",
      required: true
    },
    {
      id: 9,
      type: "single_choice",
      title: "å¯¹æ¯”ä¸‰å¹´å‰çš„è‡ªå·±ï¼Œä½ æ›´æ¥è¿‘å“ªç§å˜åŒ–ï¼Ÿ",
      options: [
        "å¿ƒæ€æ˜æ˜¾æˆç†Ÿäº†",
        "æŠ€æœ¯è¿›æ­¥ï¼Œä½†æƒ…ç»ªæ²¡å˜",
        "å˜å¾—æ›´ç„¦è™‘",
        "æ›´ä½›ç³»ã€æ›´æ‘†çƒ‚",
        "è¯´ä¸ä¸Šæ¥"
      ],
      touch: "æŠ•èµ„æˆé•¿ï¼Œé¦–å…ˆæ˜¯å¿ƒæ™ºæˆé•¿ã€‚",
      required: true
    },
    {
      id: 10,
      type: "multiple_choice",
      title: "å½“ä½ çŠ¹è±«æ˜¯å¦æ“ä½œæ—¶ï¼Œæœ€å®¹æ˜“å¡ä½ä½ çš„çœŸå®éšœç¢æ˜¯ï¼Ÿ",
      options: [
        "æ€•äºæŸ â†’ ä¸æ•¢ä¸‹æ‰‹",
        "æ€•é”™è¿‡ â†’ å†²åŠ¨è¿½é«˜",
        "ä¿¡æ¯å¤ªå¤š â†’ æ— æ³•åˆ¤æ–­",
        "ä¸ä¼šæ‹©æ—¶ â†’ ä¸€æ‹–å†æ‹–",
        "è¿‡å»äºè¿‡ â†’ å¿ƒæ€å˜å½¢",
        "å¯¹è‡ªå·±æ²¡ä¿¡å¿ƒ â†’ è·Ÿé£æ“ä½œ"
      ],
      touch: "ä½ å¡ä½çš„åœ°æ–¹ï¼Œå°±æ˜¯ä½ çš„æŠ•èµ„ç›²åŒºã€‚",
      required: true
    },
    {
      id: 11,
      type: "multiple_choice",
      title: "ä½ ä¸»è¦ä¾èµ–å“ªäº›ä¿¡æ¯æ¥æºåšå†³ç­–ï¼Ÿ",
      options: [
        "ç¤¾äº¤åª’ä½“è§‚ç‚¹",
        "KOL / ä¸»æ’­",
        "è‡ªå·±ç³»ç»Ÿç ”ç©¶",
        "æœ‹å‹æ¨è",
        "æœºæ„ç ”æŠ¥",
        "AI / æ™ºèƒ½å·¥å…·"
      ],
      allowOtherText: true,
      otherPlaceholder: "å¯å¡«å†™å…·ä½“å…³æ³¨çš„è´¦å·æˆ–ç½‘ç«™",
      touch: "ä½ ä¿¡ä»€ä¹ˆï¼Œå†³å®šä½ æ€ä¹ˆçœ‹ä¸–ç•Œã€‚æˆ‘ä»¬ä¼šåŸºäºä½ çš„ç”»åƒåŒ¹é…å­¦ä¹ å¯¹è±¡æ˜¯å¦å½“å‰æœ€ä¼˜é€‰æ‹©ã€‚Please notice: we only provide analysis, without suggestion.",
      required: true
    },
    {
      id: 12,
      type: "single_choice",
      title: "æ‰€è°“å›æ’¤æ˜¯æŒ‡ï¼šè´¦æˆ·æµ®äºåˆ°ä¸€å®šç¨‹åº¦æ—¶ï¼Œä½ è¿˜ç¡å¾—ç€è§‰å—ï¼Ÿä½ å¯ä»¥æ¥å—çš„æœ€å¤§çŸ­æœŸå›æ’¤æ˜¯ï¼Ÿ",
      options: [
        "5%",
        "10%",
        "20%",
        "30% ä»¥ä¸Š"
      ],
      touch: "å›æ’¤é˜ˆå€¼ï¼Œå°±æ˜¯ä½ çš„å¿ƒç†å®‰å…¨è¾¹ç•Œã€‚",
      required: true
    },
    {
      id: 13,
      type: "multiple_choice",
      title: "ä½ å½“å‰å®é™…æŒæœ‰çš„èµ„äº§ç±»å‹æœ‰ï¼Ÿ",
      options: [
        "ç°é‡‘",
        "è‚¡ç¥¨ / ETF",
        "åŸºé‡‘",
        "åŠ å¯†èµ„äº§",
        "å€ºåˆ¸ / å›ºæ”¶",
        "å…¶ä»–"
      ],
      allowOtherText: true,
      touch: "æŒä»“æ¯”è¯­è¨€æ›´è¯šå®ã€‚",
      required: true
    },
    {
      id: 14,
      type: "ranking",
      title: "å½“ä»¥ä¸‹ä»·å€¼ä¸å¯å…¼å¾—æ—¶ï¼Œè¯·æŒ‰ä½ çœŸå®å–èˆé¡ºåºæ’åº",
      options: [
        "æ”¶ç›Š",
        "é£é™©æ§åˆ¶",
        "æµåŠ¨æ€§",
        "å­¦ä¹ ä¸æˆé•¿",
        "è´¢å¯Œç¨³å®šæ„Ÿ"
      ],
      touch: "æ¯ä¸€æ¬¡æ’åºï¼Œéƒ½æ˜¯å’Œå†…å¿ƒä»·å€¼çš„å¯¹è¯ã€‚",
      required: true
    },
    {
      id: 15,
      type: "single_choice",
      title: "ä½ çš„ä¸»è¦æ”¶å…¥æ¥æºæ›´æ¥è¿‘å“ªä¸€ç§ï¼Ÿ",
      options: [
        "å·¥èµ„",
        "åˆ›ä¸š / è‡ªç”±èŒä¸š",
        "æŠ•èµ„æ”¶ç›Š",
        "å®¶åº­æ”¯æŒ",
        "å…¶ä»–"
      ],
      touch: "æ”¶å…¥ç»“æ„å†³å®šä½ çš„å®‰å…¨å«åšåº¦ã€‚",
      required: true
    },
    {
      id: 16,
      type: "single_choice",
      title: "ä½ ç†æƒ³çš„æŠ•èµ„èŠ‚å¥æ›´æ¥è¿‘ï¼Ÿ",
      options: [
        "ç¨³ç¨³å‘ä¸Š",
        "å¯æ¥å—æ³¢åŠ¨",
        "æ„¿æ‰¿å—è¾ƒå¤§æ³¢åŠ¨",
        "çƒ­ç‚¹è¿›å‡ºå‹"
      ],
      touch: "æŠ•èµ„èŠ‚å¥ï¼Œå¾€å¾€æ˜ å°„äººç”ŸèŠ‚å¥ã€‚",
      required: true
    },
    {
      id: 17,
      type: "single_choice",
      title: "ä½ æ„¿æ„ä¸ºæŠ•èµ„æŒç»­æŠ•å…¥çš„æ—¶é—´å¤§æ¦‚æ˜¯ï¼Ÿ",
      options: [
        "æ¯å¤© 1 å°æ—¶ä»¥ä¸Š",
        "æ¯å¤© 10â€“30 åˆ†é’Ÿ",
        "æ¯å‘¨ 1 å°æ—¶",
        "è¶Šå°‘è¶Šå¥½ï¼Œé‡åœ¨ç»“æœ"
      ],
      touch: "æ—¶é—´æŠ•å…¥ï¼Œå°±æ˜¯ä½ å¯¹æœªæ¥çš„ä¸‹æ³¨æ¯”ä¾‹ã€‚",
      required: true
    },
    {
      id: 18,
      type: "single_choice",
      title: "ä½ å¯¹æ™ºèƒ½æŠ•èµ„/è‡ªåŠ¨åŒ–å·¥å…·çš„æ€åº¦æ˜¯ï¼Ÿ",
      options: [
        "éå¸¸æ„¿æ„ä½¿ç”¨",
        "æ„¿æ„å°è¯•",
        "ä¸å¤ªæ„¿æ„",
        "ä¸ä¼šä½¿ç”¨"
      ],
      touch: "ä½ æ˜¯å¦æ„¿æ„æŠŠéƒ¨åˆ†æ§åˆ¶æƒäº¤ç»™ç³»ç»Ÿï¼Ÿ",
      required: true
    },
    {
      id: 19,
      type: "multiple_choice",
      title: "ä½ æœ€å¸Œæœ›è·å¾—å“ªç±»æŠ•èµ„æ”¯æŒï¼Ÿ",
      options: [
        "æ¸…æ™°çš„ä¹°å–å‚è€ƒ",
        "ç³»ç»ŸåŒ–æ–¹æ³•æ¡†æ¶",
        "èµ„äº§é…ç½®é€»è¾‘",
        "æƒ…ç»ªç®¡ç†é™ªä¼´",
        "çƒ­ç‚¹è¿½è¸ªè§£è¯»",
        "æŠ•èµ„è€…ç¤¾ç¾¤"
      ],
      touch: "ä½ æ¸´æœ›çš„æ”¯æŒï¼Œæ­£æ˜¯ä½ æƒ³è·¨è¶Šçš„å…³å£ã€‚",
      required: true
    },
    {
      id: 20,
      type: "single_choice",
      title: "ä½ å¯¹å½“å‰æŠ•èµ„ä½“éªŒæœ€ä¸æ»¡æ„çš„æ˜¯ï¼Ÿ",
      options: [
        "ä¿¡æ¯å¤ªæ‚ä¹±",
        "å†…å®¹éš¾ç†è§£",
        "å†³ç­–æ²¡ä¾æ®",
        "å·¥å…·å¤ªå¤æ‚",
        "æ”¶ç›Šä¸ç¨³å®š",
        "ç¼ºä¹æˆé•¿æŒ‡å¼•"
      ],
      touch: "æœ€çœŸå®çš„ç—›ç‚¹ï¼Œå¾€å¾€æŒ‡å‘ä½ ä¸‹ä¸€æ­¥çš„çªç ´å£ã€‚",
      required: true
    },
    {
      id: 21,
      type: "open_text",
      title: "å¦‚æœåªèƒ½é—®ä½ ä¸€å¥ï¼šä½ ç°åœ¨åœ¨æŠ•èµ„ä¸Šï¼Œæœ€æƒ³è§£å†³çš„"å¡ç‚¹"æ˜¯ä»€ä¹ˆï¼Ÿ",
      options: [],
      touch: "ä½ æ„¿æ„è®¤çœŸå†™ä¸‹çš„é—®é¢˜ï¼Œé€šå¸¸å·²ç»åœ¨ä½ å¿ƒé‡Œå‘é…µå¾ˆä¹…äº†ã€‚",
      required: false
    }
  ]
};

// å¯¼å‡ºå¸¸é‡
export const MBTI_TYPES = [
  'INTJ', 'INTP', 'ENTJ', 'ENTP',
  'INFJ', 'INFP', 'ENFJ', 'ENFP',
  'ISTJ', 'ISFJ', 'ESTJ', 'ESFJ',
  'ISTP', 'ISFP', 'ESTP', 'ESFP'
];

export const ZODIAC_SIGNS = [
  'ç™½ç¾Šåº§', 'é‡‘ç‰›åº§', 'åŒå­åº§', 'å·¨èŸ¹åº§',
  'ç‹®å­åº§', 'å¤„å¥³åº§', 'å¤©ç§¤åº§', 'å¤©èåº§',
  'å°„æ‰‹åº§', 'æ‘©ç¾¯åº§', 'æ°´ç“¶åº§', 'åŒé±¼åº§'
];

äº”ã€Dify AIé›†æˆå®ç°
5.1 DifyæœåŠ¡é…ç½®
typescript
// services/difyService.ts

interface DifyAnalysisInput {
  userId: string;
  sessionId: string;
  entryPoint: string;
  mbtiType?: string;
  zodiacSign?: string;
  responses: Array<{
    questionId: number;
    questionTitle: string;
    answer: any;
  }>;
}

interface DifyAnalysisOutput {
  summary: string;
  investorProfile: {
    riskTolerance: string;
    investmentStyle: string;
    timeHorizon: string;
    emotionalPattern: string;
  };
  blindSpots: string[];
  strengths: string[];
  recommendations: string[];
  fullAnalysis: string;
}

class DifyService {
  private apiKey: string;
  private apiUrl: string;
  private timeout: number;

  constructor() {
    this.apiKey = process.env.DIFY_API_KEY!;
    this.apiUrl = process.env.DIFY_API_URL || 'https://api.dify.ai/v1';
    this.timeout = 120000; // 120ç§’
  }

  /**
   * ç”ŸæˆæŠ•èµ„åˆ†ææŠ¥å‘Š
   */
  async generateAnalysis(input: DifyAnalysisInput): Promise<DifyAnalysisOutput> {
    try {
      // 1. æ ¼å¼åŒ–é—®å·æ•°æ®ä¸ºåˆ†æPrompt
      const analysisPrompt = this.formatAnalysisPrompt(input);

      // 2. è°ƒç”¨Dify API
      const response = await fetch(`${this.apiUrl}/chat-messages`, {
        method: 'POST',
        headers: {
          'Authorization': `Bearer ${this.apiKey}`,
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({
          inputs: {
            survey_data: analysisPrompt,
            entry_point: input.entryPoint,
            mbti_type: input.mbtiType || '',
            zodiac_sign: input.zodiacSign || ''
          },
          query: this.getAnalysisQuery(),
          response_mode: 'blocking',
          user: input.userId,
          conversation_id: input.sessionId
        }),
        signal: AbortSignal.timeout(this.timeout)
      });

      if (!response.ok) {
        throw new Error(`Dify APIé”™è¯¯: ${response.status}`);
      }

      const result = await response.json();

      // 3. è§£æAIå“åº”
      return this.parseAnalysisResponse(result);

    } catch (error) {
      console.error('Difyåˆ†æå¤±è´¥:', error);
      throw error;
    }
  }

  /**
   * æ ¼å¼åŒ–åˆ†æPrompt
   */
  private formatAnalysisPrompt(input: DifyAnalysisInput): string {
    const sections: string[] = [];

    // åŸºæœ¬ä¿¡æ¯
    sections.push(`## ç”¨æˆ·åŸºæœ¬ä¿¡æ¯`);
    sections.push(`- å…¥å£æ–¹å¼: ${input.entryPoint}`);
    if (input.mbtiType) sections.push(`- MBTIç±»å‹: ${input.mbtiType}`);
    if (input.zodiacSign) sections.push(`- æ˜Ÿåº§: ${input.zodiacSign}`);
    sections.push('');

    // é—®å·å›ç­”
    sections.push(`## é—®å·å›ç­”è¯¦æƒ…`);
    input.responses.forEach((response, index) => {
      sections.push(`### é—®é¢˜ ${index + 1}: ${response.questionTitle}`);
      sections.push(`å›ç­”: ${JSON.stringify(response.answer, null, 2)}`);
      sections.push('');
    });

    return sections.join('\n');
  }

  /**
   * è·å–åˆ†ææŸ¥è¯¢è¯­å¥
   */
  private getAnalysisQuery(): string {
    return `è¯·åŸºäºç”¨æˆ·æä¾›çš„21ä¸ªé—®å·ç­”æ¡ˆï¼Œç”Ÿæˆä¸€ä»½æ·±åº¦çš„æŠ•èµ„è§‰å¯Ÿåˆ†ææŠ¥å‘Šã€‚

**åˆ†æè¦æ±‚ï¼š**

1. **æŠ•èµ„è€…ç”»åƒ** - ç»¼åˆåˆ†æç”¨æˆ·çš„ï¼š
   - é£é™©æ‰¿å—èƒ½åŠ›ï¼ˆåŸºäºç¬¬3ã€12é¢˜ï¼‰
   - æŠ•èµ„é£æ ¼ï¼ˆä¸»åŠ¨/è¢«åŠ¨ã€çŸ­æœŸ/é•¿æœŸï¼‰
   - æ—¶é—´æŠ•å…¥æ„æ„¿
   - æƒ…ç»ªç®¡ç†èƒ½åŠ›

2. **æŠ•èµ„ç›²ç‚¹è¯Šæ–­** - è¯†åˆ«ç”¨æˆ·åœ¨ä»¥ä¸‹æ–¹é¢çš„æ½œåœ¨ç›²åŒºï¼š
   - å†³ç­–éšœç¢ï¼ˆç¬¬10é¢˜ï¼‰
   - ä¿¡æ¯æ¥æºåå·®ï¼ˆç¬¬11é¢˜ï¼‰
   - é£é™©è®¤çŸ¥åå·®
   - æ‰§è¡ŒåŠ›é—®é¢˜

3. **ä¼˜åŠ¿è¯†åˆ«** - å‘ç°ç”¨æˆ·çš„æŠ•èµ„ä¼˜åŠ¿ï¼š
   - å¿ƒæ™ºæˆç†Ÿåº¦
   - å­¦ä¹ èƒ½åŠ›
   - ç­–ç•¥ä¸€è‡´æ€§

4. **æˆé•¿è·¯å¾„å»ºè®®** - æä¾›å…·ä½“çš„æ”¹è¿›æ–¹å‘ï¼ˆæ³¨æ„ï¼šä»…åˆ†æï¼Œä¸æä¾›å…·ä½“æŠ•èµ„å»ºè®®ï¼‰

**è¾“å‡ºæ ¼å¼ï¼ˆJSONï¼‰ï¼š**
{
  "summary": "100-150å­—çš„æ€»ä½“æ¦‚è¿°",
  "investorProfile": {
    "riskTolerance": "ä½/ä¸­/é«˜",
    "investmentStyle": "ä»·å€¼å‹/æˆé•¿å‹/å¹³è¡¡å‹ç­‰",
    "timeHorizon": "çŸ­æœŸ/ä¸­æœŸ/é•¿æœŸ",
    "emotionalPattern": "æƒ…ç»ªå‹/ç†æ€§å‹/æ··åˆå‹"
  },
  "blindSpots": ["ç›²ç‚¹1", "ç›²ç‚¹2", "ç›²ç‚¹3"],
  "strengths": ["ä¼˜åŠ¿1", "ä¼˜åŠ¿2", "ä¼˜åŠ¿3"],
  "recommendations": ["å»ºè®®1", "å»ºè®®2", "å»ºè®®3"],
  "fullAnalysis": "å®Œæ•´çš„è¯¦ç»†åˆ†ææ–‡æœ¬ï¼ˆ800-1200å­—ï¼‰"
}

**æ³¨æ„äº‹é¡¹ï¼š**
- è¯­æ°”å‹å¥½ã€çœŸè¯šï¼Œåƒæœ‹å‹å¯¹è¯
- é¿å…ä¸“ä¸šæœ¯è¯­å †ç Œ
- é‡ç‚¹å…³æ³¨"è§‰å¯Ÿ"è€Œé"å»ºè®®"
- ä¸æä¾›å…·ä½“çš„ä¹°å–å»ºè®®
- å¼ºè°ƒè¿™æ˜¯å…¬ç›Šé¡¹ç›®ï¼Œä¸æ”¶è´¹`;
  }

  /**
   * è§£æAIå“åº”
   */
  private parseAnalysisResponse(difyResponse: any): DifyAnalysisOutput {
    try {
      const answerText = difyResponse.answer || difyResponse.content;

      // å°è¯•è§£æJSON
      if (typeof answerText === 'string') {
        // ç§»é™¤å¯èƒ½çš„markdownä»£ç å—æ ‡è®°
        const cleanText = answerText
          .replace(/```json\n?/g, '')
          .replace(/```\n?/g, '')
          .trim();

        const parsed = JSON.parse(cleanText);
        return parsed as DifyAnalysisOutput;
      }

      throw new Error('æ— æ³•è§£æAIå“åº”');
    } catch (error) {
      console.error('è§£æAIå“åº”å¤±è´¥:', error);
      
      // é™çº§æ–¹æ¡ˆï¼šè¿”å›åŸºç¡€ç»“æ„
      return {
        summary: "æŠ±æ­‰ï¼Œåˆ†ææŠ¥å‘Šç”Ÿæˆé‡åˆ°é—®é¢˜ï¼Œè¯·ç¨åé‡è¯•ã€‚",
        investorProfile: {
          riskTolerance: "å¾…åˆ†æ",
          investmentStyle: "å¾…åˆ†æ",
          timeHorizon: "å¾…åˆ†æ",
          emotionalPattern: "å¾…åˆ†æ"
        },
        blindSpots: [],
        strengths: [],
        recommendations: [],
        fullAnalysis: "æŠ¥å‘Šç”Ÿæˆå¤±è´¥ï¼Œè¯·è”ç³»æ”¯æŒå›¢é˜Ÿã€‚"
      };
    }
  }

  /**
   * ç”Ÿæˆè½»é‡é¢„è§ˆç‰ˆ
   */
  generatePreview(fullReport: DifyAnalysisOutput): any {
    return {
      summary: fullReport.summary,
      keyInsights: [
        ...fullReport.blindSpots.slice(0, 2),
        ...fullReport.strengths.slice(0, 2)
      ],
      profileHighlights: {
        riskLevel: fullReport.investorProfile.riskTolerance,
        style: fullReport.investorProfile.investmentStyle
      }
    };
  }
}

export default new DifyService();
5.2 æŠ¥å‘Šç”Ÿæˆæµç¨‹å®ç°
typescript
// controllers/surveyController.ts

import { PrismaClient } from '@prisma/client';
import difyService from '../services/difyService';
import emailService from '../services/emailService';

const prisma = new PrismaClient();

export async function submitSurvey(req: any, res: any) {
  const { userId, sessionId } = req.body;

  try {
    // 1. éªŒè¯ç”¨æˆ·å’Œä¼šè¯å­˜åœ¨
    const user = await prisma.user.findUnique({
      where: { id: userId }
    });

    if (!user) {
      return res.status(404).json({
        success: false,
        error: { code: 'USER_NOT_FOUND', message: 'ç”¨æˆ·ä¸å­˜åœ¨' }
      });
    }

    // 2. è·å–æ‰€æœ‰é—®å·å›ç­”
    const responses = await prisma.surveyResponse.findMany({
      where: { sessionId },
      orderBy: { questionId: 'asc' }
    });

    // 3. éªŒè¯å¿…å¡«é¢˜æ˜¯å¦éƒ½å·²å›ç­”
    const requiredQuestions = INVESTMENT_SURVEY.questions
      .filter(q => q.required)
      .map(q => q.id);

    const answeredQuestions = responses.map(r => r.questionId);
    const missingQuestions = requiredQuestions.filter(
      qId => !answeredQuestions.includes(qId)
    );

    if (missingQuestions.length > 0) {
      return res.status(400).json({
        success: false,
        error: {
          code: 'INCOMPLETE_SURVEY',
          message: 'è¯·å®Œæˆæ‰€æœ‰å¿…å¡«é—®é¢˜',
          details: { missingQuestions }
        }
      });
    }

    // 4. åˆ›å»ºæŠ¥å‘Šè®°å½•ï¼ˆçŠ¶æ€ï¼šgeneratingï¼‰
    await prisma.analysisReport.create({
      data: {
        userId,
        sessionId,
        reportContent: {},
        status: 'GENERATING'
      }
    });

    // 5. ç«‹å³è¿”å›202
    res.status(202).json({
      success: true,
      data: {
        sessionId,
        status: 'generating',
        message: 'é—®å·å·²æäº¤ï¼Œæ­£åœ¨ç”Ÿæˆåˆ†ææŠ¥å‘Š'
      }
    });

    // 6. å¼‚æ­¥ç”ŸæˆæŠ¥å‘Šï¼ˆä¸é˜»å¡å“åº”ï¼‰
    generateReportAsync(userId, sessionId, user, responses);

  } catch (error) {
    console.error('æäº¤é—®å·å¤±è´¥:', error);
    res.status(500).json({
      success: false,
      error: {
        code: 'SUBMIT_FAILED',
        message: 'æäº¤å¤±è´¥ï¼Œè¯·é‡è¯•'
      }
    });
  }
}

/**
 * å¼‚æ­¥ç”ŸæˆæŠ¥å‘Š
 */
async function generateReportAsync(
  userId: string,
  sessionId: string,
  user: any,
  responses: any[]
) {
  try {
    // 1. æ ¼å¼åŒ–é—®å·æ•°æ®
    const formattedResponses = responses.map(r => ({
      questionId: r.questionId,
      questionTitle: INVESTMENT_SURVEY.questions.find(
        q => q.id === r.questionId
      )?.title || '',
      answer: r.answer
    }));

    // 2. è°ƒç”¨Difyç”Ÿæˆåˆ†æ
    const analysisResult = await difyService.generateAnalysis({
      userId,
      sessionId,
      entryPoint: user.entryPoint,
      mbtiType: user.mbtiType,
      zodiacSign: user.zodiacSign,
      responses: formattedResponses
    });

    // 3. ç”Ÿæˆé¢„è§ˆç‰ˆ
    const previewContent = difyService.generatePreview(analysisResult);

    // 4. ä¿å­˜å®Œæ•´æŠ¥å‘Š
    await prisma.analysisReport.update({
      where: { sessionId },
      data: {
        reportContent: analysisResult,
        previewContent,
        status: 'COMPLETED'
      }
    });

    // 5. å‘é€é‚®ä»¶
    await emailService.sendAnalysisReport(
      user.email,
      user,
      analysisResult
    );

    // 6. æ ‡è®°é‚®ä»¶å·²å‘é€
    await prisma.analysisReport.update({
      where: { sessionId },
      data: { emailSent: true }
    });

    console.log(`æŠ¥å‘Šç”ŸæˆæˆåŠŸ: ${sessionId}`);

  } catch (error) {
    console.error('æŠ¥å‘Šç”Ÿæˆå¤±è´¥:', error);

    // æ›´æ–°æŠ¥å‘ŠçŠ¶æ€ä¸ºå¤±è´¥
    await prisma.analysisReport.update({
      where: { sessionId },
      data: {
        status: 'FAILED',
        errorMessage: error instanceof Error ? error.message : 'æœªçŸ¥é”™è¯¯'
      }
    });
  }
}

å…­ã€é‚®ä»¶æœåŠ¡å®ç°
6.1 é‚®ä»¶æœåŠ¡é…ç½®
typescript
// services/emailService.ts

import { Resend } from 'resend';

const resend = new Resend(process.env.RESEND_API_KEY);

interface EmailAnalysisReport {
  to: string;
  user: any;
  analysis: any;
}

class EmailService {
  /**
   * å‘é€åˆ†ææŠ¥å‘Šé‚®ä»¶
   */
  async sendAnalysisReport(
    email: string,
    user: any,
    analysis: any
  ): Promise<void> {
    try {
      const htmlContent = this.generateReportHTML(user, analysis);

      await resend.emails.send({
        from: 'Investment Awareness <noreply@investmentawareness.com>',
        to: email,
        subject: 'ğŸ¯ æ‚¨çš„æŠ•èµ„è§‰å¯Ÿåˆ†ææŠ¥å‘Šå·²ç”Ÿæˆ',
        html: htmlContent
      });

      console.log(`é‚®ä»¶å‘é€æˆåŠŸ: ${email}`);
    } catch (error) {
      console.error('é‚®ä»¶å‘é€å¤±è´¥:', error);
      throw error;
    }
  }

  /**
   * ç”ŸæˆæŠ¥å‘ŠHTML
   */
  private generateReportHTML(user: any, analysis: any): string {
    return `
<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      line-height: 1.6;
      color: #333;
      max-width: 600px;
      margin: 0 auto;
      padding: 20px;
      background-color: #f5f5f5;
    }
    .container {
      background: white;
      padding: 40px;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    .header {
      text-align: center;
      margin-bottom: 40px;
      border-bottom: 2px solid #0ea5e9;
      padding-bottom: 20px;
    }
    .header h1 {
      color: #0ea5e9;
      margin: 0;
      font-size: 28px;
    }
    .section {
      margin-bottom: 30px;
    }
    .section-title {
      font-size: 20px;
      color: #0ea5e9;
      margin-bottom: 15px;
      font-weight: 600;
    }
    .profile-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 15px;
      margin-bottom: 20px;
    }
    .profile-item {
      background: #f0f9ff;
      padding: 15px;
      border-radius: 8px;
      border-left: 3px solid #0ea5e9;
    }
    .profile-label {
      font-size: 12px;
      color: #6b7280;
      margin-bottom: 5px;
    }
    .profile-value {
      font-size: 16px;
      font-weight: 600;
      color: #111827;
    }
    .list-item {
      background: #f9fafb;
      padding: 12px 15px;
      margin-bottom: 10px;
      border-radius: 6px;
      border-left: 3px solid #10b981;
    }
    .blindspot-item {
      border-left-color: #f59e0b;
    }
    .full-analysis {
      background: #f9fafb;
      padding: 20px;
      border-radius: 8px;
      line-height: 1.8;
    }
    .footer {
      text-align: center;
      margin-top: 40px;
      padding-top: 20px;
      border-top: 1px solid #e5e7eb;
      color: #6b7280;
      font-size: 14px;
    }
    .cta-button {
      display: inline-block;
      background: #0ea5e9;
      color: white;
      padding: 12px 30px;
      text-decoration: none;
      border-radius: 6px;
      margin-top: 20px;
      font-weight: 600;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>ğŸ¯ æ‚¨çš„æŠ•èµ„è§‰å¯Ÿåˆ†ææŠ¥å‘Š</h1>
      <p style="color: #6b7280; margin-top: 10px;">
        è¿™æ˜¯ä¸€åœºå…³äºä½ å½“å‰æŠ•èµ„çŠ¶æ€çš„æ·±åº¦å¯¹è¯
      </p>
    </div>

    <div class="section">
      <p style="font-size: 18px; color: #111827; line-height: 1.8;">
        ${analysis.summary}
      </p>
    </div>

    <div class="section">
      <div class="section-title">ğŸ“Š æ‚¨çš„æŠ•èµ„è€…ç”»åƒ</div>
      <div class="profile-grid">
        <div class="profile-item">
          <div class="profile-label">é£é™©æ‰¿å—èƒ½åŠ›</div>
          <div class="profile-value">${analysis.investorProfile.riskTolerance}</div>
        </div>
        <div class="profile-item">
          <div class="profile-label">æŠ•èµ„é£æ ¼</div>
          <div class="profile-value">${analysis.investorProfile.investmentStyle}</div>
        </div>
        <div class="profile-item">
          <div class="profile-label">æ—¶é—´å‘¨æœŸ</div>
          <div class="profile-value">${analysis.investorProfile.timeHorizon}</div>
        </div>
        <div class="profile-item">
          <div class="profile-label">æƒ…ç»ªæ¨¡å¼</div>
          <div class="profile-value">${analysis.investorProfile.emotionalPattern}</div>
        </div>
      </div>
    </div>

    <div class="section">
      <div class="section-title">âš ï¸ æŠ•èµ„ç›²ç‚¹è¯Šæ–­</div>
      ${analysis.blindSpots.map((blindspot: string) => `
        <div class="list-item blindspot-item">${blindspot}</div>
      `).join('')}
    </div>

    <div class="section">
      <div class="section-title">âœ¨ æ‚¨çš„æŠ•èµ„ä¼˜åŠ¿</div>
      ${analysis.strengths.map((strength: string) => `
        <div class="list-item">${strength}</div>
      `).join('')}
    </div>

    <div class="section">
      <div class="section-title">ğŸ¯ æˆé•¿è·¯å¾„å»ºè®®</div>
      ${analysis.recommendations.map((rec: string, index: number) => `
        <div class="list-item">${index + 1}. ${rec}</div>
      `).join('')}
    </div>

    <div class="section">
      <div class="section-title">ğŸ“ å®Œæ•´æ·±åº¦åˆ†æ</div>
      <div class="full-analysis">
        ${analysis.fullAnalysis.split('\n').map((para: string) => 
          para ? `<p style="margin-bottom: 15px;">${para}</p>` : ''
        ).join('')}
      </div>
    </div>

    <div class="footer">
      <p><strong>ğŸ’¡ è¿™æ˜¯ä¸€ä¸ªå…¬ç›Šé¡¹ç›®ï¼Œå®Œå…¨å…è´¹</strong></p>
      <p>å¦‚æœè¿™ä»½æŠ¥å‘Šå¯¹ä½ æœ‰å¸®åŠ©ï¼Œæ¬¢è¿åˆ†äº«ç»™æ›´å¤šéœ€è¦çš„æœ‹å‹</p>
      
      <a href="https://investmentawareness.com/feedback?session=${user.sessionId}" 
         class="cta-button">
        ç•™ä¸‹ä½ çš„åé¦ˆ
      </a>
      
      <p style="margin-top: 30px; font-size: 12px;">
        è¯·æ³¨æ„ï¼šæœ¬æŠ¥å‘Šä»…æä¾›æŠ•èµ„è§‰å¯Ÿåˆ†æï¼Œä¸æ„æˆä»»ä½•æŠ•èµ„å»ºè®®ã€‚<br>
        æŠ•èµ„æœ‰é£é™©ï¼Œå†³ç­–éœ€è°¨æ…ã€‚
      </p>
    </div>
  </div>
</body>
</html>
    `;
  }
}

export default new EmailService();

ä¸ƒã€å‰ç«¯å®ç°è¯¦ç»†è®¾è®¡
7.1 å‰ç«¯ç›®å½•ç»“æ„
frontend/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ app/
â”‚   â”‚   â”œâ”€â”€ page.tsx                    # é¦–é¡µï¼ˆä¸‰å…¥å£ï¼‰
â”‚   â”‚   â”œâ”€â”€ entry/
â”‚   â”‚   â”‚   â””â”€â”€ [type]/page.tsx        # å…¥å£åˆ†æµï¼ˆMBTI/æ˜Ÿåº§ï¼‰
â”‚   â”‚   â”œâ”€â”€ survey/
â”‚   â”‚   â”‚   â””â”€â”€ [sessionId]/page.tsx   # é—®å·é¡µ
â”‚   â”‚   â””â”€â”€ report/
â”‚   â”‚       â””â”€â”€ [sessionId]/page.tsx   # æŠ¥å‘Šé¢„è§ˆé¡µ
â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”œâ”€â”€ EmailModal.tsx             # é‚®ç®±å¼¹çª—
â”‚   â”‚   â”œâ”€â”€ survey/
â”‚   â”‚   â”‚   â”œâ”€â”€ QuestionCard.tsx       # é—®é¢˜å¡ç‰‡
â”‚   â”‚   â”‚   â”œâ”€â”€ SingleChoice.tsx       # å•é€‰é¢˜
â”‚   â”‚   â”‚   â”œâ”€â”€ MultipleChoice.tsx     # å¤šé€‰é¢˜
â”‚   â”‚   â”‚   â”œâ”€â”€ RankingQuestion.tsx    # æ’åºé¢˜ï¼ˆé‡ç‚¹ï¼‰
â”‚   â”‚   â”‚   â”œâ”€â”€ OpenText.tsx           # å¼€æ”¾é¢˜
â”‚   â”‚   â”‚   â””â”€â”€ ProgressBar.tsx        # è¿›åº¦æ¡
â”‚   â”‚   â”œâ”€â”€ entry/
â”‚   â”‚   â”‚   â”œâ”€â”€ MBTIGrid.tsx           # MBTIé€‰æ‹©ç½‘æ ¼
â”‚   â”‚   â”‚   â””â”€â”€ ZodiacGrid.tsx         # æ˜Ÿåº§é€‰æ‹©ç½‘æ ¼
â”‚   â”‚   â””â”€â”€ report/
â”‚   â”‚       â”œâ”€â”€ ReportPreview.tsx      # æŠ¥å‘Šé¢„è§ˆ
â”‚   â”‚       â””â”€â”€ LoadingAnimation.tsx   # åŠ è½½åŠ¨ç”»
â”‚   â”œâ”€â”€ hooks/
â”‚   â”‚   â”œâ”€â”€ useSurvey.ts               # é—®å·é€»è¾‘
â”‚   â”‚   â”œâ”€â”€ useAutoSave.ts             # è‡ªåŠ¨ä¿å­˜
â”‚   â”‚   â””â”€â”€ useReportPolling.ts        # æŠ¥å‘Šè½®è¯¢
â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â””â”€â”€ api.ts                     # APIå°è£…
â”‚   â”œâ”€â”€ store/
â”‚   â”‚   â””â”€â”€ surveyStore.ts             # çŠ¶æ€ç®¡ç†
â”‚   â””â”€â”€ types/
â”‚       â””â”€â”€ index.ts                   # ç±»å‹å®šä¹‰
â”œâ”€â”€ public/
â””â”€â”€ package.json
7.2 æ ¸å¿ƒç»„ä»¶å®ç°
ç»„ä»¶1ï¼šé‚®ç®±å¼¹çª—
typescript
// components/EmailModal.tsx

'use client';

import { useState } from 'react';
import { useRouter } from 'next/navigation';
import { api } from '@/services/api';

interface EmailModalProps {
  isOpen: boolean;
  entryPoint: 'MBTI' | 'ZODIAC' | 'CLASSIC';
  onClose: () => void;
}

export default function EmailModal({ isOpen, entryPoint, onClose }: EmailModalProps) {
  const [email, setEmail] = useState('');
  const [loading, setLoading] = useState(false);
  const [error, setError] = useState('');
  const router = useRouter();

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    setError('');

    // é‚®ç®±æ ¼å¼éªŒè¯
    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    if (!emailRegex.test(email)) {
      setError('è¯·è¾“å…¥æœ‰æ•ˆçš„é‚®ç®±åœ°å€');
      return;
    }

    setLoading(true);

    try {
      // åˆ›å»ºç”¨æˆ·ä¼šè¯
      const response = await api.createUser(email, entryPoint);

      // ä¿å­˜åˆ°localStorage
      localStorage.setItem('userId', response.data.userId);
      localStorage.setItem('sessionId', response.data.sessionId);
      localStorage.setItem('email', email);

      // è·³è½¬åˆ°å¯¹åº”å…¥å£
      if (entryPoint === 'CLASSIC') {
        router.push(`/survey/${response.data.sessionId}`);
      } else {
        router.push(`/entry/${entryPoint.toLowerCase()}`);
      }

    } catch (err: any) {
      setError(err.message || 'åˆ›å»ºä¼šè¯å¤±è´¥ï¼Œè¯·é‡è¯•');
    } finally {
      setLoading(false);
    }
  };

  if (!isOpen) return null;

  return (
    <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4">
      <div className="bg-white rounded-2xl max-w-md w-full p-8 relative">
        <button
          onClick={onClose}
          className="absolute top-4 right-4 text-gray-400 hover:text-gray-600"
        >
          âœ•
        </button>

        <div className="text-center mb-6">
          <h2 className="text-2xl font-bold text-gray-900 mb-2">
            ğŸ“§ å¼€å§‹ä½ çš„è§‰å¯Ÿä¹‹æ—…
          </h2>
          <p className="text-gray-600">
            å®Œæ•´çš„åˆ†ææŠ¥å‘Šå°†å‘é€åˆ°ä½ çš„é‚®ç®±
          </p>
        </div>

        <form onSubmit={handleSubmit}>
          <div className="mb-4">
            <label className="block text-sm font-medium text-gray-700 mb-2">
              é‚®ç®±åœ°å€
            </label>
            <input
              type="email"
              value={email}
              onChange={(e) => setEmail(e.target.value)}
              placeholder="your@email.com"
              className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:border-blue-500 focus:outline-none transition-colors"
              required
            />
            {error && (
              <p className="mt-2 text-sm text-red-600">{error}</p>
            )}
          </div>

          <button
            type="submit"
            disabled={loading}
            className="w-full bg-blue-500 text-white py-3 rounded-lg font-semibold hover:bg-blue-600 transition-colors disabled:bg-gray-300 disabled:cursor-not-allowed"
          >
            {loading ? 'åˆ›å»ºä¸­...' : 'å¼€å§‹è¯Šæ–­'}
          </button>
        </form>

        <p className="mt-4 text-xs text-gray-500 text-center">
          ğŸ”’ æˆ‘ä»¬æ‰¿è¯ºä¿æŠ¤ä½ çš„éšç§ï¼Œä¸ä¼šå‘ç¬¬ä¸‰æ–¹åˆ†äº«ä½ çš„ä¿¡æ¯
        </p>
      </div>
    </div>
  );
}
ç»„ä»¶2ï¼šæ’åºé¢˜ï¼ˆé‡ç‚¹å®ç°ï¼‰
typescript
// components/survey/RankingQuestion.tsx

'use client';

import { useState, useEffect } from 'react';
import { DragDropContext, Droppable, Draggable } from '@hello-pangea/dnd';

interface RankingQuestionProps {
  questionId: number;
  title: string;
  options: string[];
  touch?: string;
  onAnswer: (answer: any) => void;
  initialAnswer?: any;
}

export default function RankingQuestion({
  questionId,
  title,
  options,
  touch,
  onAnswer,
  initialAnswer
}: RankingQuestionProps) {
  const [availableOptions, setAvailableOptions] = useState<string[]>(options);
  const [rankedOptions, setRankedOptions] = useState<string[]>([]);

  useEffect(() => {
    // æ¢å¤ä¹‹å‰çš„ç­”æ¡ˆ
    if (initialAnswer?.rankedValues) {
      const ranked = initialAnswer.rankedValues
        .sort((a: any, b: any) => a.order - b.order)
        .map((item: any) => item.value);
      setRankedOptions(ranked);
      setAvailableOptions(options.filter(opt => !ranked.includes(opt)));
    }
  }, [initialAnswer, options]);

  const handleOptionClick = (option: string) => {
    // ä»å¯é€‰é¡¹ç§»åˆ°å·²æ’åº
    setAvailableOptions(prev => prev.filter(opt => opt !== option));
    setRankedOptions(prev => {
      const newRanked = [...prev, option];
      
      // ä¿å­˜ç­”æ¡ˆ
      const answer = {
        type: 'ranking',
        rankedValues: newRanked.map((value, index) => ({
          order: index + 1,
          value
        }))
      };
      onAnswer(answer);

      return newRanked;
    });
  };

  const handleRemoveRanked = (option: string, index: number) => {
    // ä»å·²æ’åºç§»å›å¯é€‰é¡¹
    setRankedOptions(prev => prev.filter((_, i) => i !== index));
    setAvailableOptions(prev => [...prev, option]);
  };

  const isComplete = rankedOptions.length === options.length;

  return (
    <div className="space-y-6">
      <div>
        <h3 className="text-2xl font-semibold text-gray-900 mb-2">
          {title}
        </h3>
        {touch && (
          <p className="text-sm text-blue-600 italic">{touch}</p>
        )}
      </div>

      {/* å·²æ’åºåŒºåŸŸ */}
      <div className="bg-blue-50 rounded-xl p-6 border-2 border-blue-200">
        <div className="flex items-center justify-between mb-4">
          <h4 className="font-semibold text-gray-900">
            ä½ çš„æ’åº ({rankedOptions.length}/{options.length})
          </h4>
          {isComplete && (
            <span className="text-green-600 font-semibold">âœ“ å®Œæˆ</span>
          )}
        </div>

        {rankedOptions.length === 0 ? (
          <p className="text-gray-500 text-center py-8">
            ç‚¹å‡»ä¸‹æ–¹é€‰é¡¹å¼€å§‹æ’åº
          </p>
        ) : (
          <div className="space-y-3">
            {rankedOptions.map((option, index) => (
              <div
                key={option}
                className="bg-white rounded-lg p-4 shadow-sm flex items-center justify-between group hover:shadow-md transition-shadow"
              >
                <div className="flex items-center gap-3">
                  <span className="w-8 h-8 bg-blue-500 text-white rounded-full flex items-center justify-center font-semibold">
                    {index + 1}
                  </span>
                  <span className="font-medium text-gray-900">{option}</span>
                </div>
                <button
                  onClick={() => handleRemoveRanked(option, index)}
                  className="text-gray-400 hover:text-red-500 opacity-0 group-hover:opacity-100 transition-opacity"
                >
                  âœ•
                </button>
              </div>
            ))}
          </div>
        )}
      </div>

      {/* å¯é€‰é¡¹åŒºåŸŸ */}
      {availableOptions.length > 0 && (
        <div>
          <h4 className="font-semibold text-gray-700 mb-3">
            ç‚¹å‡»é€‰é¡¹æ·»åŠ åˆ°æ’åº
          </h4>
          <div className="grid grid-cols-1 gap-3">
            {availableOptions.map((option) => (
              <button
                key={option}
                onClick={() => handleOptionClick(option)}
                className="bg-white border-2 border-gray-200 rounded-lg p-4 text-left hover:border-blue-500 hover:bg-blue-50 transition-all"
              >
                <span className="text-gray-900">{option}</span>
              </button>
            ))}
          </div>
        </div>
      )}
    </div>
  );
}
ç»„ä»¶3ï¼šé—®å·ä¸»é¡µé¢
typescript
// app/survey/[sessionId]/page.tsx

'use client';

import { useState, useEffect } from 'react';
import { useParams, useRouter } from 'next/navigation';
import { INVESTMENT_SURVEY } from '@/config/survey';
import QuestionCard from '@/components/survey/QuestionCard';
import ProgressBar from '@/components/survey/ProgressBar';
import { api } from '@/services/api';

export default function SurveyPage() {
  const params = useParams();
  const router = useRouter();
  const sessionId = params.sessionId as string;

  const [currentQuestionIndex, setCurrentQuestionIndex] = useState(0);
  const [answers, setAnswers] = useState<Record<number, any>>({});
  const [submitting, setSubmitting] = useState(false);

  const currentQuestion = INVESTMENT_SURVEY.questions[currentQuestionIndex];
  const progress = ((currentQuestionIndex + 1) / INVESTMENT_SURVEY.questions.length) * 100;

  // ä¿å­˜ç­”æ¡ˆ
  const handleAnswer = async (questionId: number, answer: any) => {
    // æ›´æ–°æœ¬åœ°çŠ¶æ€
    setAnswers(prev => ({ ...prev, [questionId]: answer }));

    // è‡ªåŠ¨ä¿å­˜åˆ°æœåŠ¡å™¨
    try {
      const userId = localStorage.getItem('userId');
      await api.saveAnswer({
        userId: userId!,
        sessionId,
        questionId,
        answer
      });
    } catch (error) {
      console.error('ä¿å­˜å¤±è´¥:', error);
      // å¯ä»¥æ·»åŠ é‡è¯•é€»è¾‘
    }
  };

  // ä¸‹ä¸€é¢˜
  const handleNext = () => {
    if (currentQuestionIndex < INVESTMENT_SURVEY.questions.length - 1) {
      setCurrentQuestionIndex(prev => prev + 1);
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }
  };

  // ä¸Šä¸€é¢˜
  const handlePrevious = () => {
    if (currentQuestionIndex > 0) {
      setCurrentQuestionIndex(prev => prev - 1);
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }
  };

  // æäº¤é—®å·
  const handleSubmit = async () => {
    setSubmitting(true);

    try {
      const userId = localStorage.getItem('userId');
      await api.submitSurvey(userId!, sessionId);

      // è·³è½¬åˆ°æŠ¥å‘Šé¡µ
      router.push(`/report/${sessionId}`);
    } catch (error) {
      console.error('æäº¤å¤±è´¥:', error);
      alert('æäº¤å¤±è´¥ï¼Œè¯·é‡è¯•');
      setSubmitting(false);
    }
  };

  const isLastQuestion = currentQuestionIndex === INVESTMENT_SURVEY.questions.length - 1;
  const canProceed = answers[currentQuestion.id] !== undefined;

  return (
    <div className="min-h-screen bg-gray-50">
      {/* è¿›åº¦æ¡ */}
      <ProgressBar 
        progress={progress}
        currentQuestion={currentQuestionIndex + 1}
        totalQuestions={INVESTMENT_SURVEY.questions.length}
      />

      {/* é—®å·å†…å®¹ */}
      <div className="max-w-3xl mx-auto px-4 py-12">
        <QuestionCard
          question={currentQuestion}
          answer={answers[currentQuestion.id]}
          onAnswer={(answer) => handleAnswer(currentQuestion.id, answer)}
        />

        {/* å¯¼èˆªæŒ‰é’® */}
        <div className="flex justify-between mt-8">
          <button
            onClick={handlePrevious}
            disabled={currentQuestionIndex === 0}
            className="px-6 py-3 bg-gray-200 text-gray-700 rounded-lg font-semibold hover:bg-gray-300 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"
          >
            â† ä¸Šä¸€é¢˜
          </button>

          {isLastQuestion ? (
            <button
              onClick={handleSubmit}
              disabled={!canProceed || submitting}
              className="px-8 py-3 bg-blue-500 text-white rounded-lg font-semibold hover:bg-blue-600 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"
            >
              {submitting ? 'æäº¤ä¸­...' : 'æäº¤é—®å· â†’'}
            </button>
          ) : (
            <button
              onClick={handleNext}
              disabled={!canProceed}
              className="px-6 py-3 bg-blue-500 text-white rounded-lg font-semibold hover:bg-blue-600 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"
            >
              ä¸‹ä¸€é¢˜ â†’
            </button>
          )}
        </div>

        {/* ä¿å­˜æç¤º */}
        {canProceed && (
          <p className="text-center mt-4 text-sm text-green-600">
            âœ“ ç­”æ¡ˆå·²è‡ªåŠ¨ä¿å­˜
          </p>
        )}
      </div>
    </div>
  );
}

å…«ã€éƒ¨ç½²ä¸ç¯å¢ƒé…ç½®
8.1 ç¯å¢ƒå˜é‡é…ç½®
env
# .env

# æ•°æ®åº“
DATABASE_URL="postgresql://user:password@localhost:5432/investment_awareness"

# Dify AI
DIFY_API_KEY="app-xxxxx"
DIFY_API_URL="https://api.dify.ai/v1"

# é‚®ä»¶æœåŠ¡
RESEND_API_KEY="re_xxxxx"
EMAIL_FROM="noreply@investmentawareness.com"

# åº”ç”¨é…ç½®
NODE_ENV="production"
PORT=3001
FRONTEND_URL="https://investmentawareness.com"

# CORS
ALLOWED_ORIGINS="https://investmentawareness.com,https://www.investmentawareness.com"
8.2 æ¨èéƒ¨ç½²æ–¹æ¡ˆ
å‰ç«¯ï¼š Vercel
è‡ªåŠ¨ä»Gitéƒ¨ç½²
å…¨çƒCDN
å…è´¹SSL
åç«¯ï¼š Railway / Render
è‡ªåŠ¨éƒ¨ç½²
å†…ç½®PostgreSQL
å…è´¹tierå¯ç”¨
é‚®ä»¶ï¼š Resend
å¼€å‘è€…å‹å¥½
å…è´¹é¢åº¦å¤Ÿç”¨
ä¼˜ç§€çš„é€è¾¾ç‡

ä¹ã€å¼€å‘ä¼˜å…ˆçº§
P0ï¼ˆMVPæ ¸å¿ƒï¼‰
æ•°æ®åº“è®¾è®¡ä¸è¿ç§»
ç”¨æˆ·åˆ›å»ºAPI
é—®å·æäº¤API
æ’åºé¢˜ç»„ä»¶å®ç°
Difyé›†æˆ
é‚®ä»¶å‘é€
P1ï¼ˆé‡è¦åŠŸèƒ½ï¼‰
MBTI/æ˜Ÿåº§å…¥å£
æŠ¥å‘Šè½®è¯¢
é”™è¯¯å¤„ç†
è‡ªåŠ¨ä¿å­˜ä¼˜åŒ–
P2ï¼ˆä¼˜åŒ–é¡¹ï¼‰
æŠ¥å‘Šé¢„è§ˆé¡µç¾åŒ–
åŠ è½½åŠ¨ç”»
æ•°æ®åˆ†æåå°
ç”¨æˆ·åé¦ˆç³»ç»Ÿ

åã€æµ‹è¯•æ¸…å•
åŠŸèƒ½æµ‹è¯•
é‚®ç®±æ”¶é›†æµç¨‹
æ‰€æœ‰é¢˜å‹æ­£ç¡®ä¿å­˜
æ’åºé¢˜äº¤äº’å®Œæ•´
æŠ¥å‘Šç”ŸæˆæˆåŠŸ
é‚®ä»¶æ­£å¸¸å‘é€
è¾¹ç•Œæµ‹è¯•
å¿…å¡«é¢˜æœªç­”å®Œæ— æ³•æäº¤
ç½‘ç»œå¤±è´¥é‡è¯•
AIç”Ÿæˆå¤±è´¥é™çº§
é‚®ç®±æ ¼å¼éªŒè¯
æ€§èƒ½æµ‹è¯•
å•ä¸ªç­”æ¡ˆä¿å­˜ < 500ms
æŠ¥å‘Šç”Ÿæˆ < 2åˆ†é’Ÿ
é¡µé¢åŠ è½½ < 3ç§’

å˜æ›´è®°å½•
æ—¥æœŸ
ç‰ˆæœ¬
å˜æ›´å†…å®¹
å˜æ›´äºº
2024-12-10
v1.0
åˆå§‹ç‰ˆæœ¬
[å§“å]

Cursoræ‰§è¡ŒæŒ‡å¼•ï¼š
é¦–å…ˆåˆ›å»ºæ•°æ®åº“å’ŒPrismaæ¨¡å‹
å®ç°åç«¯APIï¼ˆæŒ‰ç«¯ç‚¹é¡ºåºï¼‰
å®ç°DifyæœåŠ¡é›†æˆ
å®ç°é‚®ä»¶æœåŠ¡
å®ç°å‰ç«¯ç»„ä»¶ï¼ˆç‰¹åˆ«å…³æ³¨æ’åºé¢˜ï¼‰
æµ‹è¯•å®Œæ•´æµç¨‹
éƒ¨ç½²ä¸Šçº¿



ç¾å›½å¸‚åœº Cç«¯é—®å·äº¤äº’ä¸è®¾è®¡è§„èŒƒ (Final IDD)
é¡¹ç›®: US Market High-Trust Survey 2024
æ ¸å¿ƒå“²å­¦: æ¢å®â€œå®‰å…¨æ„Ÿä¸é›¶è´Ÿæ‹…â€åŸåˆ™ (Security & Zero Cognitive Burden)
è®¾è®¡ç›®æ ‡: æ‰“é€ æµç•…ã€å¯ä¿¡ã€å‹å¥½ä¸”é›¶å­¦ä¹ æˆæœ¬çš„é—®å·ä½“éªŒã€‚

1. è§†è§‰è®¾è®¡ç³»ç»Ÿ (Visual Design Requirements)
1.1 è‰²å½©è§„èŒƒ (Color System)
ä¸¥æ ¼éµå¾ªï¼šSoft Peach ä¸å¾—ä¸»å¯¼ UIï¼Œä»…ä½œä¸ºç‚¹ç¼€ã€‚
è¯­ä¹‰è§’è‰²
é¢œè‰²å®šä¹‰
ç”¨é€”è¯´æ˜
Trust Base (åŸºè°ƒ)
Cool Gray / Misty Blue
#F3F4F6 / #E2E8F0ã€‚ç”¨äºèƒŒæ™¯ï¼Œè¥é€ ä¸“ä¸šã€å†·é™ã€å«ç”Ÿçš„ä¿¡ä»»æ„Ÿ (Professional Mood)ã€‚
Primary CTA (æƒ…æ„Ÿ)
Soft Peach (Pantone 13-1023)
#FFBE98ã€‚ä»…ç”¨äºï¼šCTA æŒ‰é’®ã€é«˜äº®è¾¹æ¡†ã€æƒ…æ„Ÿå¾®åé¦ˆã€‚ä¸å¯å¤§é¢ç§¯é“ºé™ˆã€‚
Accent / Focus
Deep Teal / Blue
#0F766E / #2563EBã€‚ç”¨äºè¾“å…¥æ¡†èšç„¦çŠ¶æ€ (Focus)ã€è¿›åº¦æ¡å¡«å……ã€æ´»è·ƒå…ƒç´ ã€‚
Success / Support
Natural Green / Beige
ç”¨äºå®Œæˆæç¤ºæˆ–å®‰æŠšæ€§çš„è§†è§‰çº¿ç´¢ã€‚
Button Gradient
Peach â†’ Rose Peach
ä»…ç”¨äºä¸»è¦ CTA æŒ‰é’®ï¼Œå¢åŠ ç‚¹å‡»æ¬²ï¼Œé¿å…å…¶ä»–ä½ç½®ä½¿ç”¨æ¸å˜ã€‚
1.2 æ’ç‰ˆä¸å±‚çº§ (Visual Hierarchy)
å­—ä½“: Inter æˆ– System UI (San Francisco/Segoe UI)ã€‚
å­—å·:
é—®é¢˜ (H1): 20px - 24px (Bold, Dark Gray)
æ­£æ–‡/é€‰é¡¹: 16px - 18px (Medium) - å¤§å­—å·ä»¥ç¡®ä¿æ˜“è¯»æ€§ã€‚
ç•™ç™½: ä½¿ç”¨å¤§é¢ç§¯ç•™ç™½ (Large Whitespace)ï¼Œå¡ç‰‡å†… Padding è‡³å°‘ 24px (ç§»åŠ¨ç«¯) / 32px (PCç«¯)ã€‚

2. å¸ƒå±€ä¸ç»“æ„ (Layout Requirements)
2.1 å“åº”å¼å¡ç‰‡å¸ƒå±€
å½¢æ€: Card-based Layoutã€‚æ‰€æœ‰å†…å®¹æ‰¿è½½äºä¸­å¿ƒåŒ–çš„åœ†è§’å¡ç‰‡ä¸­ï¼Œæ¨¡å—åˆ†ç¦»æ¸…æ™°ã€‚
ä»»åŠ¡èšç„¦: Single-task UIã€‚ä¸¥æ ¼æ‰§è¡Œâ€œä¸€å±ä¸€é¢˜â€ï¼Œæœç»å¹²æ‰°ã€‚
å¯¼èˆªæŒ‡ç¤º: å³ä½¿æ˜¯è‡ªåŠ¨è·³è½¬ï¼Œé¡¶éƒ¨å¿…é¡»å§‹ç»ˆæ‚¬æµ®å¯è§çš„ Progress Bar (è¿›åº¦æ¡)ã€‚
2.2 ç§»åŠ¨ç«¯ä¼˜å…ˆ (Mobile Adaptation)
è§¦æ§ç›®æ ‡: æ‰€æœ‰ç‚¹å‡»åŒºåŸŸ (Tap areas) é«˜åº¦è‡³å°‘ 56px (44px + padding)ï¼Œå®½åº¦é“ºæ»¡å±å¹•ï¼Œé€‚åˆå¤§æ‹‡æŒ‡æ“ä½œã€‚
è¾“å…¥ä½“éªŒ: è‡ªåŠ¨å”¤èµ·å¯¹åº”é”®ç›˜ï¼ˆæ•°å­—é”®ç›˜ã€Emailé”®ç›˜ï¼‰ã€‚

3. äº¤äº’é€»è¾‘ (Interaction Rules)
3.1 è‡ªåŠ¨è·³è½¬ (Auto-Advance)
è§¦å‘æ¡ä»¶: ç”¨æˆ·ç‚¹å‡»å•é€‰é¡¹ OR å®Œæˆå¹¶é€šè¿‡è¾“å…¥æ ¡éªŒã€‚
å¾®äº¤äº’å»¶è¿Ÿ: 0.4sã€‚
ç›®çš„: Context retention (ä¿ç•™ä¸Šä¸‹æ–‡)ï¼Œè®©ç”¨æˆ·çœ‹æ¸…è‡ªå·±é€‰äº†ä»€ä¹ˆï¼Œç¡®è®¤ç³»ç»Ÿå·²æ¥æ”¶ã€‚
åŠ¨æ•ˆ: æ—§å¡ç‰‡æ·¡å‡ºï¼Œæ–°å¡ç‰‡æ»‘å…¥ (Smooth fade-in)ã€‚
3.2 æŒ‰é’®ä¸çŠ¶æ€ (Button & States)
æ˜¾å¼æ–‡æ¡ˆ: å½“å¿…é¡»å‡ºç°æŒ‰é’®æ—¶ï¼ˆå¦‚å¤šé€‰æˆ–ä»‹ç»é¡µï¼‰ï¼Œæ–‡æ¡ˆå¿…é¡»å…·ä½“ï¼š
âœ… "Next question (X/Y)"
âŒ "Continue", "Next"
å­—æ®µçŠ¶æ€ (Field States):
Default: Light gray border (border-gray-200).
Focus: Blue/Teal glow (ring-blue-500).
Error: Red border + Clear Text Message. (ç¦æ­¢ä»…é é¢œè‰²æŠ¥é”™ï¼Œå¿…é¡»ç¬¦åˆ WCAG)ã€‚
3.3 ç»„ä»¶äº¤äº’ (Zero Learning)
Single Choice: å…¨å®½å¤§å¡ç‰‡ï¼Œç‚¹å‡»å³èµ°ã€‚
Multi-select: ä½¿ç”¨æ¸…æ™°çš„å¤é€‰æ¡† (Checkboxes)ï¼Œå¿…é¡»é…åˆ "Next question" æŒ‰é’®ã€‚
Dropdowns: å¿…é¡»å…¨å±å±•å¼€æˆ–ä½¿ç”¨ Bottom Sheetï¼Œç¡®ä¿é€‰é¡¹æ¸…æ™°å¯è§ã€‚

4. ç‰¹æ®Šé¢˜å‹å¤„ç† (Special Handling)
æ ¹æ®æ‚¨çš„æ ‡ç­¾ç³»ç»Ÿå®šä¹‰å¼€å‘é€»è¾‘ï¼š
4.1 [SPECIAL: this field needs mask]
åŠŸèƒ½: å®æ—¶æ ¼å¼åŒ–ã€‚
è§„åˆ™:
Phone: è¾“å…¥æ—¶è‡ªåŠ¨æ ¼å¼åŒ–ä¸º US æ ¼å¼ (123) 456-7890ã€‚
Validation: å®æ—¶æ ¡éªŒ (Real-time)ï¼Œä¸è¦ç­‰åˆ°è·³è½¬æ—¶æ‰æŠ¥é”™ã€‚
4.2 [SPECIAL: multi-step question]
åŠŸèƒ½: å¤åˆé—®é¢˜å•å±å¤„ç†ã€‚
äº¤äº’: ä¾‹å¦‚åœ°å€è¾“å…¥ï¼Œåœ¨ä¸€ä¸ªå¡ç‰‡å†…åˆ†æ­¥å±•ç¤ºã€‚è¾“å…¥ Zip Code åï¼Œè‡ªåŠ¨å±•å¼€ City/State å­—æ®µï¼Œåˆ©ç”¨ Address Autocomplete (AI/API) å‡å°‘è¾“å…¥ã€‚
4.3 [SPECIAL: branching required]
åŠŸèƒ½: é€»è¾‘åˆ†æ”¯ã€‚
äº¤äº’: AI-guided branchingã€‚æ ¹æ®ä¸Šä¸€é¢˜ç­”æ¡ˆï¼Œä¸‹ä¸€é¢˜å¹³æ»‘è½½å…¥ç›¸å…³é—®é¢˜ã€‚è¿‡ç¨‹å¿…é¡»æµç•…ï¼Œæ— ç¼è¡”æ¥ã€‚

5. å¾®äº¤äº’ä¸æƒ…æ„ŸåŒ– (Micro-Interactions)
åé¦ˆ: æ¯æ¬¡æœ‰æ•ˆæ“ä½œï¼Œä¼´éšè½»å¾®çš„è§†è§‰ç¡®è®¤ï¼ˆå¦‚é€‰é¡¹èƒŒæ™¯ç¬é—´å˜æš–è‰²ï¼‰ã€‚
é¼“åŠ±æ–‡æ¡ˆ: åœ¨å…³é”®èŠ‚ç‚¹ï¼ˆå¦‚ 50%, 80%ï¼‰å±•ç¤º Toast æˆ–å°å­—æç¤ºï¼š
"Almost there â€” 80% completed!"
æ§åˆ¶åŸåˆ™: ä¸ä½¿ç”¨è¿‡åº¦è®¾è®¡çš„åŠ¨ç”» (No over-designed effects)ï¼ŒåŠ¨æ•ˆä»…ä¸ºäº†è§£é‡Šç•Œé¢å˜åŒ–ã€‚

6. ä¿¡ä»»ä¸åˆè§„ (Trust & Privacy) - Mandatory
6.1 éšç§å£°æ˜ (Privacy Statement)
åœ¨å¡ç‰‡åº•éƒ¨æˆ–æ˜¾è‘—ä½ç½®ï¼Œå¿…é¡»åŒ…å«ä»¥ä¸‹å…·ä½“æ–‡æ¡ˆï¼š
[Lock Icon]
"We never sell your data."
"Your information is encrypted."
"You may opt out anytime."
6.2 SMS åˆè§„ (10DLC)
å¦‚æœæ¶‰åŠæ‰‹æœºå·è¾“å…¥ï¼Œä¸‹æ–¹å¿…é¡»å¼ºåˆ¶å±•ç¤º Opt-in Checkboxï¼š
çŠ¶æ€: é»˜è®¤ä¸å‹¾é€‰ã€‚
æ–‡æ¡ˆ:
"I agree to receive SMS about this survey."

7. å¯è®¿é—®æ€§ (Accessibility - WCAG 2.1)
é”®ç›˜å¯¼èˆª: æ”¯æŒæ ‡å‡†çš„ Tab åºå’Œ Enter/Space é€‰æ‹©ã€‚
ARIA: æ‰€æœ‰æŒ‰é’®å’Œè¾“å…¥æ¡†å¿…é¡»æœ‰æ˜ç¡®çš„ aria-labelã€‚
å¯¹æ¯”åº¦: ç¡®ä¿æ–‡å­—ä¸èƒŒæ™¯å¯¹æ¯”åº¦ > 4.5:1ã€‚
å›¾æ ‡: å›¾æ ‡å¿…é¡»é…æ–‡å­—ï¼Œä¸å¯ä»…ä½¿ç”¨é¢œè‰²è¡¨è¾¾å«ä¹‰ã€‚
å‡å¼±åŠ¨ç”»: æ”¯æŒç³»ç»Ÿçº§çš„ "Disable Animations" è®¾ç½®ã€‚

8. æŠ€æœ¯å®ç°æç¤º (For Developers)
AI Enhancement: å¦‚æœé›†æˆ AIï¼Œä»…ç”¨äºé¢„æµ‹è¾“å…¥æˆ–è°ƒæ•´é—®é¢˜èŠ‚å¥ï¼Œç»å¯¹ä¸å¯å¤ºèµ°ç”¨æˆ·çš„æ§åˆ¶æƒ (Control must remain with the user)ã€‚
Frontend: ä½¿ç”¨ React + Tailwind CSSã€‚
Logic: æ‰€æœ‰çš„æ ¡éªŒé€»è¾‘å¿…é¡»åœ¨å‰ç«¯å®æ—¶å“åº”ï¼ŒåŒæ—¶åç«¯äºŒæ¬¡æ ¡éªŒã€‚
